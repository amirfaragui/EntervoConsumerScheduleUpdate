/**
 * Kendo UI v2024.3.1015 (http://www.telerik.com/kendo-ui)
 * Copyright 2024 Progress Software Corporation and/or one of its subsidiaries or affiliates. All rights reserved.
 *
 * Kendo UI commercial licenses may be obtained at
 * http://www.telerik.com/purchase/license-agreement/kendo-ui-complete
 * If you do not own a commercial license, this file shall be governed by the trial license terms.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("kendo.core.js"),require("kendo.color.js"),require("kendo.drawing.js"),require("kendo.dataviz.core.js"),require("kendo.dataviz.chart.js")):"function"==typeof define&&define.amd?define(["kendo.core.min","kendo.color.min","kendo.drawing.min","kendo.dataviz.core.min","kendo.dataviz.chart.min"],e):((t="undefined"!=typeof globalThis?globalThis:t||self).kendodataviz=t.kendodataviz||{},t.kendodataviz.sankey=t.kendodataviz.sankey||{},t.kendodataviz.sankey.js=e())}(this,(function(){!function(t){window.kendo.dataviz=window.kendo.dataviz||{};var e=kendo.dataviz,i=e.deepExtend,o=e.constants,n=o.ARIA_ACTIVE_DESCENDANT,r=e.Box,s=e.setDefaultOptions,a=kendo.drawing,l=a.Path,h=kendo.geometry,u=e.Legend,c=function(t,e){return t.map(e).reduce((function(t,e){return t+e}),0)},d=function(t,e){return t.y0===e.y0?t.index-e.index:t.y0+t.y1-e.y0-e.y1},p=function(t,e){return d(t.source,e.source)},f=function(t,e){return d(t.target,e.target)},g=function(t){return t.value};function v(t){t.forEach((function(t){t.targetLinks.forEach((function(t){t.source.sourceLinks.sort(f)})),t.sourceLinks.forEach((function(t){t.target.targetLinks.sort(p)}))}))}var y=function(t,e){return"left"===t.align?t.depth:"right"===t.align?e-t.height:t.sourceLinks.length?t.depth:e},m=kendo.Class.extend({init:function(t){var e=t.nodesOptions,o=e.offset;void 0===o&&(o={});var n=e.align;this.data={nodes:t.nodes.map((function(t){return i({},{offset:o,align:n},t)})),links:t.links.map((function(t){return i({},t)}))},this.width=t.width,this.height=t.height,this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.nodeWidth=t.nodesOptions.width,this.nodePadding=t.nodesOptions.padding,this.reverse=t.reverse,this.targetColumnIndex=t.targetColumnIndex,this.loops=t.loops,this.autoLayout=t.autoLayout},calculate:function(){var e=this.data,i=e.nodes,o=e.links;this.connectLinksToNodes(i,o),this.calculateNodeValues(i);var n=this.calculateNodeHeights(i);if(n)return{nodes:[],links:[],columns:[],circularLinks:n};this.calculateNodeDepths(i);var r=this.calculateNodeColumns(i);return this.calculateNodeBreadths(r),this.applyNodesOffset(i),this.calculateLinkBreadths(i),t.extend({},this.data,{columns:r})},connectLinksToNodes:function(t,e){var i=new Map;t.forEach((function(t,e){t.index=e,t.sourceLinks=[],t.targetLinks=[],t.id=void 0!==t.id?t.id:t.label.text,i.set(t.id,t)})),e.forEach((function(t){t.source=i.get(t.sourceId),t.target=i.get(t.targetId),t.source.sourceLinks.push(t),t.target.targetLinks.push(t)}))},calculateNodeValues:function(t){t.forEach((function(t){t.value=Math.max(c(t.sourceLinks,g),c(t.targetLinks,g))}))},calculateNodeDepths:function(t){for(var e=new Set(t),i=new Set,o=0;e.size;){for(var n=Array.from(e),r=0;r<n.length;r++){var s=n[r];s.depth=o;for(var a=0;a<s.sourceLinks.length;a++){var l=s.sourceLinks[a];i.add(l.target)}}o++,e=i,i=new Set}},calculateNodeHeights:function(t){for(var e=t.length,i=new Set(t),o=new Set,n=0,r=function(t){t.height=n,t.targetLinks.forEach((function(t){o.add(t.source)}))};i.size;){if(i.forEach(r),++n>e)return!0;i=o,o=new Set}return!1},calculateNodeColumns:function(t){for(var e,i,o=(e=t,i=function(t){return t.depth},Math.max.apply(null,e.map(i))),n=(this.width-this.offsetX-this.nodeWidth)/o,r=new Array(o+1),s=0;s<t.length;s++){var a=t[s],l=Math.max(0,Math.min(o,y(a,o)));a.x0=this.offsetX+l*n,a.x1=a.x0+this.nodeWidth,a.layer=l,r[l]=r[l]||[],r[l].push(a)}return r},calculateNodeBreadths:function(t){var e,i,o=this,n=(e=t,i=function(t){return(o.height-o.offsetY-(t.length-1)*o.nodePadding)/c(t,g)},Math.min.apply(null,e.map(i)));if(t.forEach((function(t){var e=o.offsetY;t.forEach((function(t){t.y0=e,t.y1=e+t.value*n,e=t.y1+o.nodePadding,t.sourceLinks.forEach((function(t){t.width=t.value*n}))})),e=(o.height-e+o.nodePadding)/(t.length+1),t.forEach((function(t,i){t.y0+=e*(i+1),t.y1+=e*(i+1)}))})),!1!==this.autoLayout)for(var r=void 0!==this.loops?this.loops:t.length-1,s=this.targetColumnIndex||1,a=0;a<r;a++)o.reverse?(o.uncurlLinksToRight(t,s),o.uncurlLinksToLeft(t,s)):(o.uncurlLinksToLeft(t,s),o.uncurlLinksToRight(t,s));t.forEach(v)},applyNodesOffset:function(t){t.forEach((function(t){var e=(t.offset?t.offset.left:0)||0,i=(t.offset?t.offset.top:0)||0;t.x0+=e,t.x1+=e,t.y0+=i,t.y1+=i}))},calculateLinkBreadths:function(t){t.forEach((function(t){var e=t.sourceLinks,i=t.targetLinks,o=t.y0,n=o;e.forEach((function(t){t.x0=t.source.x1,t.y0=o+t.width/2,o+=t.width})),i.forEach((function(t){t.x1=t.target.x0,t.y1=n+t.width/2,n+=t.width}))}))},uncurlLinksToRight:function(t,e){for(var i=this,o=t.length,n=e;n<o;n++){var r=t[n];r.forEach((function(t){var e=0,o=0;t.targetLinks.forEach((function(n){var r=n.value*(t.layer-n.source.layer);e+=i.targetTopPos(n.source,t)*r,o+=r}));var n=0===e?0:e/o-t.y0;t.y0+=n,t.y1+=n,v([t])})),r.sort(d),i.arrangeNodesVertically(r)}},uncurlLinksToLeft:function(t,e){for(var i=this,o=t.length-1-e;o>=0;o--){for(var n=t[o],r=function(t){var e=n[t],o=0,r=0;e.sourceLinks.forEach((function(t){var n=t.value*(t.target.layer-e.layer);o+=i.sourceTopPos(e,t.target)*n,r+=n}));var s=0===o?0:o/r-e.y0;e.y0+=s,e.y1+=s,v([e])},s=0;s<n.length;s++)r(s);n.sort(d),i.arrangeNodesVertically(n)}},arrangeNodesVertically:function(t){var e=t.length-1;this.arrangeUp(t,this.height,e),this.arrangeDown(t,this.offsetY,0)},arrangeDown:function(t,e,i){for(var o=e,n=i;n<t.length;n++){var r=t[n],s=Math.max(0,o-r.y0);r.y0+=s,r.y1+=s,o=r.y1+this.nodePadding}},arrangeUp:function(t,e,i){for(var o=e,n=i;n>=0;--n){var r=t[n],s=Math.max(0,r.y1-o);r.y0-=s,r.y1-=s,o=r.y0-this.nodePadding}},sourceTopPos:function(t,e){for(var i=e.y0-(e.targetLinks.length-1)*this.nodePadding/2,o=0;o<e.targetLinks.length;o++){var n=e.targetLinks[o];if(n.source===t)break;i+=n.width+this.nodePadding}for(var r=0;r<t.sourceLinks.length;r++){var s=t.sourceLinks[r];if(s.target===e)break;i-=s.width}return i},targetTopPos:function(t,e){for(var i=t.y0-(t.sourceLinks.length-1)*this.nodePadding/2,o=0;o<t.sourceLinks.length;o++){var n=t.sourceLinks[o];if(n.target===e)break;i+=n.width+this.nodePadding}for(var r=0;r<e.targetLinks.length;r++){var s=e.targetLinks[r];if(s.source===t)break;i-=s.width}return i}}),k=function(t){return new m(t).calculate()};function _(t,e,i,o,n,r){var s=(r-e)*(i-t),a=(o-e)*(n-t);return s>a?1:s===a?0:-1}var x=function(t){function e(e){t.call(this),this.options=i({},this.options,e),this.createVisual()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createVisual=function(){this.visual=this.createElement()},e.prototype.exportVisual=function(){return this.visual},e.prototype.createElement=function(){var t=this,e=this.options.visual;return e?e({sender:this.getSender(),options:this.visualOptions(),createVisual:function(){return t.getElement()}}):this.getElement()},e.prototype.getSender=function(){return this},e}(e.Class),w=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getElement=function(){return l.fromRect(this.getRect(),this.visualOptions())},e.prototype.getRect=function(){var t=this.options.node;return new h.Rect([t.x0,t.y0],[t.x1-t.x0,t.y1-t.y0])},e.prototype.getLabelText=function(t){var e=t.labels.ariaTemplate;if(e)return e({node:t.node})},e.prototype.visualOptions=function(){var t=i({},this.options,this.options.node),e=this.getLabelText(t);return{fill:{color:t.color,opacity:t.opacity},stroke:{width:0},className:"k-sankey-node",role:"graphics-symbol",ariaRoleDescription:"Node",ariaLabel:e}},e.prototype.createFocusHighlight=function(){if(this.options.navigatable)return this._highlight=new l.fromRect(this.getRect(),{stroke:this.options.focusHighlight,visible:!1}),this._highlight},e.prototype.focus=function(t){if(this._highlight){var e=(t||{}).highlight;void 0===e&&(e=!0),e&&this._highlight.options.set("visible",!0);var i=this.options.node.id;this.visual.options.set("id",i),this.options.root()&&this.options.root().setAttribute(n,i)}},e.prototype.blur=function(){this._highlight&&(this._highlight.options.set("visible",!1),this.visual.options.set("id",""),this.options.root()&&this.options.root().removeAttribute(n))},e}(x),b=function(t,e,i){return t.color||e[i%e.length]},L=function(t,e,o,n){var r=i({},e,e.node);return i({},{color:b(t,o,n)},r,{node:t},{visual:t.visual,opacity:t.opacity,offset:t.offset,color:t.color})},E=a.util.defined,T=function(t,e){var i,o,n,r,s,a,l,h,u=t.x0,c=t.x1,d=t.y0,p=t.y1,f=(u+c)/2,g=t.width,v=g/2,y=[[(u+f)/2,d-v],[(c+f)/2,p-v]],m=function(t,e){var i=t[0],o=i[0],n=i[1],r=t[1],s=r[0],a=r[1],l=e[0],h=e[1];return Math.abs((s-o)*(h-n)-(l-o)*(a-n))/Math.sqrt(Math.pow(s-o,2)+Math.pow(a-n,2))}(y,[f,(i=d+v,o=d+v,n=p+v,r=p+v,s=.5,a=1-s,l=a*a,h=s*s,i*l*a+3*o*s*l+3*n*h*a+r*h*s)]),k=(g-m)/2,_=function(t,e){var i=t[0],o=i[0],n=i[1],r=t[1],s=r[0],a=r[1],l=e[0],h=l[0],u=l[1],c=e[1],d=c[0],p=c[1],f=Math.atan2(a-n,s-o),g=Math.atan2(p-u,d-h);return Math.abs(f-g)}(y,[[u,d-v],[f,d-v]]),x=k,w=Math.sin(_)*x,b=d-p>0?-1:1;return e&&(b=-b),b*Math.sqrt(x*x+w*w)},S=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getElement=function(){var t=this.options.link,e=t.x0,i=t.x1,o=t.y0,n=t.y1,r=(e+i)/2;return new l(this.visualOptions()).moveTo(e,o).curveTo([r,o],[r,n],[i,n])},e.prototype.getLabelText=function(t){var e=t.labels.ariaTemplate;if(e)return e({link:t.link})},e.prototype.visualOptions=function(){var t=this.options,e=this.options.link,i=this.getLabelText(t);return{stroke:{width:t.link.width,color:e.color||t.color,opacity:E(e.opacity)?e.opacity:t.opacity},role:"graphics-symbol",ariaRoleDescription:"Link",ariaLabel:i}},e.prototype.createFocusHighlight=function(){if(this.options.navigatable){var t=this.options,e=t.link,i=t.rtl,o=e.x0,n=e.x1,r=e.y0,s=e.y1,a=(o+n)/2,h=e.width/2,u=T(e,i);this._highlight=new l({stroke:this.options.focusHighlight,visible:!1}).moveTo(o,r+h).lineTo(o,r-h).curveTo([a+u,r-h],[a+u,s-h],[n,s-h]).lineTo(n,s+h).curveTo([a-u,s+h],[a-u,r+h],[o,r+h])}},e.prototype.focus=function(t){if(this._highlight){var e=(t||{}).highlight;void 0===e&&(e=!0),e&&this._highlight.options.set("visible",!0);var i=this.options.link.sourceId+"->"+this.options.link.targetId;this.visual.options.set("id",i),this.options.root()&&this.options.root().setAttribute(n,i)}},e.prototype.blur=function(){this._highlight&&(this._highlight.options.set("visible",!1),this.visual.options.set("id",""),this.options.root()&&this.options.root().removeAttribute(n))},e}(x),O="inside",I="before",N="after",z=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.getElement=function(){var t=i({},this.options,this.options.node.label),o=t.node,n=t.diagramMinX,s=t.diagramMaxX,a=t.text,l=t.offset,h=t.rtl,u=t.position;if(h&&u!==O&&(u=u===I?N:I),!t.visible||!a)return null;var c=new r(o.x0,o.y0,o.x1,o.y1),d=this.visualOptions();h&&!d.align&&(d.align="right");var p=new e.TextBox(a,d);p.reflow(new r);var f=p.box,g=c.center().y-f.height()/2,v=o.x1+f.width()>s,y=o.x0-f.width()<n,m=u===I||u===O&&v?I:N;h&&(m=u===N||u===O&&y?N:I);var k=[m===I?o.x0-f.width():o.x1,g],_=new r(k[0],k[1],k[0]+f.width(),k[1]+f.height());return _.translate(l.left||0,l.top||0),p.reflow(_),p.renderVisual(),p.visual},o.prototype.visualOptions=function(){var t=i({},this.options,this.options.node.label);return{color:t.color,font:t.font,border:t.border,margin:t.margin,padding:t.padding,align:t.align,paintOrder:t.paintOrder,stroke:t.stroke}},o}(x);s(z,{position:O});var M=function(t,e,o,n,r){return i({},e,{node:t,diagramMinX:n,diagramMaxX:r,rtl:o,visual:t.label.visual,visible:t.label.visible,margin:t.label.margin,padding:t.label.padding,border:t.label.border,align:t.label.align,offset:t.label.offset})},H=function(t){function i(){t.apply(this,arguments)}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.getElement=function(){var t=this.options,i=t.drawingRect,o=t.text;if(!1===t.visible||!o)return null;var n=e.Title.buildTitle(o,t);return n.reflow(i),n.renderVisual(),n.visual},i.prototype.createElement=function(){return this.getElement()},i}(x);s(H,{align:o.CENTER,border:{width:0},margin:e.getSpacing(5),padding:e.getSpacing(5)});var C=function(t,e){return t.node.x0-e.node.x0!=0?t.node.x0-e.node.x0:t.node.y0-e.node.y0},R=function(t,e){return t.node.x1-e.node.x1!=0?t.node.x1-e.node.x1:e.node.y0-t.node.y0},V=function(e){function i(){e.apply(this,arguments)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.getElement=function(){var e=this.options,i=e.drawingRect,n=e.rtl,r=e.nodes;void 0===r&&(r=[]);var s=e.item,a=e.position;if(!1===e.visible||!r.length)return null;var l=r.map((function(t){return{text:t.label&&t.label.text||"",area:{background:void 0!==s.areaBackground?s.areaBackground:t.color,opacity:void 0!==s.areaOpacity?s.areaOpacity:t.opacity},node:t}}));l.sort(function(t){return t?R:C}(n));var h=n&&a!==o.LEFT&&a!==o.RIGHT,c=new u(t.extend({},e,{data:l,reverse:h}),{rtl:n});return c.reflow(i),c.renderVisual(),c.visual},i.prototype.createElement=function(){return this.getElement()},i}(x);s(V,{markers:{visible:!1},item:{type:"area",cursor:o.POINTER,opacity:1},position:o.BOTTOM,align:o.CENTER,accessibility:{role:"presentation",ariaLabel:null,ariaRoleDescription:null},border:{width:0}});var B="link",D="node",A=function(n){function s(t,e,i){n.call(this),this._initTheme(i),this._setOptions(e),this._initElement(t),this._initSurface(),e&&e.data&&(this._redraw(),this._initResizeObserver(),this._initNavigation(t))}return n&&(s.__proto__=n),s.prototype=Object.create(n&&n.prototype),s.prototype.constructor=s,s.prototype.destroy=function(){this.unbind(),this._destroySurface(),this._destroyResizeObserver(),this.element&&(this.element.removeEventListener("keydown",this._keydownHandler),this.element.removeEventListener("focus",this._focusHandler),this.element.removeEventListener("mousedown",this._onDownHandler),this.element.removeEventListener("touchstart",this._onDownHandler),this.element.removeEventListener("pointerdown",this._onDownHandler)),this._focusState=null,this.element=null},s.prototype._initElement=function(t){this.element=t,e.addClass(t,["k-chart","k-sankey"]),t.setAttribute("role","graphics-document");var i=this.options.title;i.text&&t.setAttribute("aria-label",i.text),i.description&&t.setAttribute("aria-roledescription",i.description)},s.prototype._initSurface=function(){this.surface||(this._destroySurface(),this._initSurfaceElement(),this.surface=this._createSurface())},s.prototype._initNavigation=function(t){t.tabIndex=t.getAttribute("tabindex")||0,this.options.disableKeyboardNavigation||(this._keydownHandler=this._keydown.bind(this),this._focusHandler=this._focus.bind(this),this._blurHandler=this._blur.bind(this),this._onDownHandler=this._onDown.bind(this),t.addEventListener("keydown",this._keydownHandler),t.addEventListener("focus",this._focusHandler),t.addEventListener("blur",this._blurHandler),t.addEventListener("mousedown",this._onDownHandler),t.addEventListener("touchstart",this._onDownHandler),t.addEventListener("pointerdown",this._onDownHandler),this._focusState={node:this.firstFocusableNode(),link:null})},s.prototype.firstFocusableNode=function(){return this.columns[0][0]},s.prototype._initResizeObserver=function(){var t=this,e=new ResizeObserver((function(e){e.forEach((function(e){var i=e.contentRect,o=i.width,n=i.height;e.target!==t.element||t.size&&t.size.width===o&&t.size.height===n||(t.size={width:o,height:n},t.surface.setSize(t.size),t.resize=!0,t._redraw())}))}));this._resizeObserver=e,e.observe(this.element)},s.prototype._createSurface=function(){return a.Surface.create(this.surfaceElement,{mouseenter:this._mouseenter.bind(this),mouseleave:this._mouseleave.bind(this),mousemove:this._mousemove.bind(this),click:this._click.bind(this)})},s.prototype._initTheme=function(t){var e=t||this.theme||{};this.theme=e,this.options=i({},e,this.options)},s.prototype.setLinksOpacity=function(t){var e=this;this.linksVisuals.forEach((function(i){e.setOpacity(i,t,i.linkOptions.opacity)}))},s.prototype.setLinksInactivityOpacity=function(t){var e=this;this.linksVisuals.forEach((function(i){e.setOpacity(i,t,i.linkOptions.highlight.inactiveOpacity)}))},s.prototype.setOpacity=function(e,i,o){e.options.set("stroke",t.extend({},e.options.stroke,{opacity:E(o)?o:i}))},s.prototype.trigger=function(e,i){var o=i.element.dataItem,r=i.element.type,s=t.extend({},i,{type:e,targetType:r,dataItem:o});return n.prototype.trigger.call(this,e,s)},s.prototype._mouseenter=function(t){var e=t.element,i=e.type===B,o=e.type===D,n=Boolean(e.chartElement&&e.chartElement.options.node);if(!(i&&this.trigger("linkEnter",t)||o&&this.trigger("nodeEnter",t))){var r=this.options.links.highlight;if(i)this.setLinksInactivityOpacity(r.inactiveOpacity),this.setOpacity(e,r.opacity,e.linkOptions.highlight.opacity);else if(o)this.highlightLinks(e,r);else if(n){var s=this.nodesVisuals.get(e.chartElement.options.node.id);this.highlightLinks(s,r)}}},s.prototype._mouseleave=function(t){var e=this,i=t.element,o=i.type===B,n=i.type===D,r=Boolean(i.chartElement&&i.chartElement.options.node),s=t.originalEvent.relatedTarget;o&&s&&"text"===s.nodeName||((o||n)&&(this.tooltipTimeOut&&(clearTimeout(this.tooltipTimeOut),this.tooltipTimeOut=null),this.tooltipShown=!1,this.trigger("tooltipHide",t)),o&&this.trigger("linkLeave",t)||n&&this.trigger("nodeLeave",t)||(o||n||r)&&this.linksVisuals.forEach((function(t){e.setOpacity(t,e.options.links.opacity,t.linkOptions.opacity)})))},s.prototype._mousemove=function(t){var e=this,i=this.options.tooltip,o=i.followPointer,n=i.delay,r=t.element,s=r.type;if(!(s!==B&&s!==D||this.tooltipShown&&!o)){var a=t.originalEvent,l=this.element.getBoundingClientRect(),h=a.clientX-l.left<l.width/2,u=a.clientY-l.top<l.height/2;if(t.tooltipData={popupOffset:{left:a.pageX,top:a.pageY},popupAlign:{horizontal:h?"left":"right",vertical:u?"top":"bottom"}},s===D){var c=r.dataItem,d=c.sourceLinks,p=c.targetLinks,f=p.length?p:d;t.nodeValue=f.reduce((function(t,e){return t+e.value}),0)}this.tooltipTimeOut&&(clearTimeout(this.tooltipTimeOut),this.tooltipTimeOut=null);var g=o&&this.tooltipShown?0:n;this.tooltipTimeOut=setTimeout((function(){e.trigger("tooltipShow",t),e.tooltipShown=!0,e.tooltipTimeOut=null}),g)}},s.prototype._click=function(t){var e=t.element,i=e.dataItem,o=e.type===B,n=e.type===D,r=this._focusState||{};if(n)!r.link&&this.sameNode(r.node,i)||(this._focusState={node:i,link:null},this._focusNode({highlight:!1})),this.trigger("nodeClick",t);else if(o){var s={sourceId:i.source.id,targetId:i.target.id,value:i.value};this.sameLink(r.link,s)||(this._focusState={node:i.source,link:s},this._focusLink({highlight:!1})),this.trigger("linkClick",t)}},s.prototype.sameNode=function(t,e){return t&&e&&t.id===e.id},s.prototype.sameLink=function(t,e){return t&&e&&t.sourceId===e.sourceId&&t.targetId===e.targetId},s.prototype._focusNode=function(t){this._cleanFocusHighlight();var e=this._focusState.node;this.models.map.get(e.id).focus(t)},s.prototype._focusLink=function(t){this._cleanFocusHighlight();var e=this._focusState.link;this.models.map.get(e.sourceId+"-"+e.targetId).focus(t)},s.prototype._focusNextNode=function(t){void 0===t&&(t=1);var e=this._focusState.node,i=this.columns.findIndex((function(t){return t.find((function(t){return t.id===e.id}))})),o=this.columns[i],n=o.findIndex((function(t){return t.id===e.id})),r=o[n+t];r&&(this._focusState.node=r,this._focusNode())},s.prototype._focusNextLink=function(t){void 0===t&&(t=1);var e=this._focusState.node,i=this._focusState.link,o=e.sourceLinks.findIndex((function(t){return t.sourceId===i.sourceId&&t.targetId===i.targetId})),n=e.targetLinks.findIndex((function(t){return t.sourceId===i.sourceId&&t.targetId===i.targetId}));if(-1!==o){var r=e.sourceLinks[o+t];r&&(this._focusState.link=r,this._focusLink())}else if(-1!==n){var s=e.targetLinks[n+t];s&&(this._focusState.link=s,this._focusLink())}},s.prototype._focusSourceNode=function(){var t=this._focusState.link,e=this.models.map.get(t.sourceId);this._focusState={node:e.options.node,link:null},this._focusNode()},s.prototype._focusTargetNode=function(){var t=this._focusState.link,e=this.models.map.get(t.targetId);this._focusState={node:e.options.node,link:null},this._focusNode()},s.prototype._focusSourceLink=function(){var t=this._focusState.node.sourceLinks[0];t&&(this._focusState.link=t,this._focusLink())},s.prototype._focusTargetLink=function(){var t=this._focusState.node.targetLinks[0];t&&(this._focusState.link=t,this._focusLink())},s.prototype._focus=function(){this._skipFocusHighlight||(this._focusState.link?this._focusLink():this._focusNode()),this._skipFocusHighlight=!1},s.prototype._blur=function(){this._cleanFocusHighlight()},s.prototype._onDown=function(){this._hasFocus()||(this._skipFocusHighlight=!0)},s.prototype._hasFocus=function(){return this.element.ownerDocument.activeElement===this.element},s.prototype._cleanFocusHighlight=function(){this.models.nodes.forEach((function(t){return t.blur()})),this.models.links.forEach((function(t){return t.blur()}))},s.prototype._keydown=function(t){var e=this["on"+t.key],i=this.options.rtl;i&&"ArrowLeft"===t.key?e=this.onArrowRight:i&&"ArrowRight"===t.key&&(e=this.onArrowLeft),e&&e.call(this,t)},s.prototype.onEscape=function(t){t.preventDefault(),this._focusState={node:this.firstFocusableNode(),link:null},this._focusNode()},s.prototype.onArrowDown=function(t){t.preventDefault(),this._focusState.link?this._focusNextLink(1):this._focusNextNode(1)},s.prototype.onArrowUp=function(t){t.preventDefault(),this._focusState.link?this._focusNextLink(-1):this._focusNextNode(-1)},s.prototype.onArrowLeft=function(t){t.preventDefault(),this._focusState.link?this._focusSourceNode():this._focusTargetLink()},s.prototype.onArrowRight=function(t){t.preventDefault(),this._focusState.link?this._focusTargetNode():this._focusSourceLink()},s.prototype.highlightLinks=function(t,e){var i=this;t&&(this.setLinksInactivityOpacity(e.inactiveOpacity),t.links.forEach((function(t){i.setOpacity(t,e.opacity,t.linkOptions.highlight.opacity)})))},s.prototype._destroySurface=function(){this.surface&&(this.surface.destroy(),this.surface=null,this._destroySurfaceElement())},s.prototype._destroyResizeObserver=function(){this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null)},s.prototype._initSurfaceElement=function(){this.surfaceElement||(this.surfaceElement=document.createElement("div"),this.element.appendChild(this.surfaceElement))},s.prototype._destroySurfaceElement=function(){this.surfaceElement&&this.surfaceElement.parentNode&&(this.surfaceElement.parentNode.removeChild(this.surfaceElement),this.surfaceElement=null)},s.prototype.setOptions=function(t,e){this._setOptions(t),this._initTheme(e),this._initSurface(),this._redraw()},s.prototype._redraw=function(){this.surface.clear();var t=this._getSize(),e=t.width,i=t.height;this.size={width:e,height:i},this.surface.setSize(this.size),this.createVisual(),this.surface.draw(this.visual)},s.prototype._getSize=function(){return this.element.getBoundingClientRect()},s.prototype.createVisual=function(){this.visual=this._render()},s.prototype.titleBox=function(e,i){return e&&!1!==e.visible&&e.text?new H(t.extend({},{drawingRect:i},e)).exportVisual().chartElement.box:null},s.prototype.legendBox=function(e,i,o){return e&&!1!==e.visible?new V(t.extend({},{nodes:i},e,{drawingRect:o})).exportVisual().chartElement.box:null},s.prototype.calculateSankey=function(i,n){var s=n.title,a=n.legend,l=n.data,h=n.nodes,u=n.labels,c=n.nodeColors,d=n.disableAutoLayout,p=n.disableKeyboardNavigation,f=n.rtl,g=!d,v=p?0:P.width/2,y=new r(0,0,i.width,i.height);y.unpad(v);var m=this.titleBox(s,y),x=y.clone();if(m){var b=m.height();s.position===o.TOP?(y.unpad({top:b}),x=new r(0,b,i.width,i.height)):(y.shrink(0,b),x=new r(0,0,i.width,i.height-b))}var E=this.legendBox(a,l.nodes,x),T=a&&a.position||V.prototype.options.position;E&&(T===o.LEFT&&y.unpad({left:E.width()}),T===o.RIGHT&&y.shrink(E.width(),0),T===o.TOP&&y.unpad({top:E.height()}),T===o.BOTTOM&&y.shrink(0,E.height()));var S=k(t.extend({},i,{offsetX:0,offsetY:0,width:y.width(),height:y.height()})),O=S.nodes,I=S.circularLinks;if(I)return console.warn("Circular links detected. Kendo Sankey diagram does not support circular links."),{sankey:{nodes:[],links:[],columns:[[]],circularLinks:I},legendBox:E,titleBox:m};var N=new r,H=O.reduce((function(t,e){return Math.min(t,e.x0)}),1/0),C=O.reduce((function(t,e){return Math.max(t,e.x1)}),0);O.forEach((function(t,i){if(f){var o=t.x0,n=t.x1;t.x0=C-n,t.x1=C-o}var r=L(t,h,c,i),s=new w(r);N.wrap(e.rectToBox(s.exportVisual().rawBBox()));var a=new z(M(t,u,f,H,C)).exportVisual();a&&N.wrap(e.rectToBox(a.rawBBox()))}));var R=y.x1,B=y.y1,D=y.width()+R,A=y.height()+B;if(D-=N.x2>y.width()?N.x2-y.width():0,A-=N.y2>y.height()?N.y2-y.height():0,R+=N.x1<0?-N.x1:0,B+=N.y1<0?-N.y1:0,!1===g)return{sankey:k(t.extend({},i,{offsetX:R,offsetY:B,width:D,height:A,autoLayout:!1})),legendBox:E,titleBox:m};if(this.resize&&g&&this.permutation)return this.resize=!1,{sankey:k(t.extend({},i,{offsetX:R,offsetY:B,width:D,height:A},this.permutation)),legendBox:E,titleBox:m};for(var F=k(t.extend({},i,{offsetX:R,offsetY:B,width:D,height:A,autoLayout:!1})).columns.length,j=[],$=function(e,o){var n=function(t){for(var e,i,o,n,r,s,a=0,l=t.length,h=0;h<l;h++)for(var u=t[h],c=h+1;c<l;c++){var d=t[c];i=d,o=void 0,n=void 0,r=void 0,s=void 0,o=_((e=u).x0,e.y0,e.x1,e.y1,i.x1,i.y1),n=_(e.x0,e.y0,e.x1,e.y1,i.x0,i.y0),r=_(e.x0,e.y0,i.x0,i.y0,i.x1,i.y1),s=_(e.x1,e.y1,i.x0,i.y0,i.x1,i.y1),o!==n&&r!==s&&(a+=Math.min(u.value,d.value))}return a}(k(t.extend({},i,{offsetX:R,offsetY:B,width:D,height:A,loops:2,targetColumnIndex:e,reverse:o})).links);return j.push({crosses:n,reverse:o,targetColumnIndex:e}),0===n},X=1;X<=F-1&&(!$(X,!1)&&!$(X,!0));X++);var Y=Math.min.apply(null,j.map((function(t){return t.crosses}))),W=j.find((function(t){return t.crosses===Y}));return this.permutation={targetColumnIndex:W.targetColumnIndex,reverse:W.reverse},{sankey:k(t.extend({},i,{offsetX:R,offsetY:B,width:D,height:A},this.permutation)),legendBox:E,titleBox:m}},s.prototype._render=function(e,o){var n=e||this.options,r=o||this,s=n.labels,u=n.nodes,c=n.links,d=n.nodeColors,p=n.title,f=n.legend,g=n.rtl,v=n.disableKeyboardNavigation,y=n.data,m=r.size,k=m.width,_=m.height,x=t.extend({},y,{width:k,height:_,nodesOptions:u,title:p,legend:f}),b=this.calculateSankey(x,n),E=b.sankey,T=b.titleBox,O=b.legendBox;g&&function(t){var e=t.nodes,i=t.links,o=Math.min.apply(Math,e.map((function(t){return t.x0}))),n=Math.max.apply(Math,e.map((function(t){return t.x1})))-o;e.forEach((function(t){var e=n-(t.x1-2*o),i=n-(t.x0-2*o);t.x0=e,t.x1=i})),i.forEach((function(t){var e=n-(t.x1-2*o),i=n-(t.x0-2*o);t.x1=e,t.x0=i}))}(E);var I=E.nodes,N=E.links,C=E.columns;r.columns=C.map((function(t){var e=t.slice();return e.sort((function(t,e){return t.y0-e.y0})),e}));var R=new a.Group({clip:l.fromRect(new h.Rect([0,0],[k,_]))});if(T){var A=new H(t.extend({},p,{drawingRect:T})).exportVisual();R.append(A)}if(E.circularLinks)return R;var P=new Map;r.nodesVisuals=P;var F={nodes:[],links:[],map:new Map};r.models=F;var j=[];I.forEach((function(e,i){var o=L(e,u,d,i);o.root=function(){return r.element},o.navigatable=!0!==v;var n=new w(o),s=n.exportVisual();s.links=[],s.type=D,e.color=o.color,e.opacity=o.opacity,s.dataItem=t.extend({},y.nodes[i],{color:o.color,opacity:o.opacity,sourceLinks:e.sourceLinks.map((function(t){return{sourceId:t.sourceId,targetId:t.targetId,value:t.value}})),targetLinks:e.targetLinks.map((function(t){return{sourceId:t.sourceId,targetId:t.targetId,value:t.value}}))}),P.set(e.id,s),F.nodes.push(n),F.map.set(e.id,n),R.append(s),n.createFocusHighlight(),n._highlight&&j.push(n._highlight)}));var $=N.slice().sort((function(t,e){return e.value-t.value})),X=[];r.linksVisuals=X,$.forEach((function(e){var o=e.source,n=e.target,s=P.get(o.id),a=P.get(n.id),l=function(t,e,o,n){var r=i({},e,{link:t,opacity:t.opacity,color:t.color,colorType:t.colorType,visual:t.visual,highlight:t.highlight});return"source"===r.colorType?r.color=o.options.fill.color:"target"===r.colorType&&(r.color=n.options.fill.color),r}(e,c,s,a);l.root=function(){return r.element},l.navigatable=!0!==v,l.rtl=g;var h=new S(l),u=h.exportVisual();u.type=B,u.dataItem={source:t.extend({},s.dataItem),target:t.extend({},a.dataItem),value:e.value},u.linkOptions=l,X.push(u),s.links.push(u),a.links.push(u),F.links.push(h),F.map.set(o.id+"-"+n.id,h),h.createFocusHighlight(),h._highlight&&j.push(h._highlight),R.append(u)}));var Y=I.reduce((function(t,e){return Math.min(t,e.x0)}),1/0),W=I.reduce((function(t,e){return Math.max(t,e.x1)}),0);if(I.forEach((function(t){var e=M(t,s,g,Y,W),i=new z(e).exportVisual();i&&R.append(i)})),O){var q=new V(t.extend({},f,{rtl:g,drawingRect:O,nodes:I})).exportVisual();R.append(q)}if(0!==j.length){var U=new a.Group;U.append.apply(U,j),R.append(U)}return R},s.prototype.exportVisual=function(t){var e=t&&t.options?i({},this.options,t.options):this.options,o={size:{width:E(t&&t.width)?t.width:this.size.width,height:E(t&&t.height)?t.height:this.size.height}};return this._render(e,o)},s.prototype._setOptions=function(t){this.options=i({},this.options,t)},s}(e.Observable),P={opacity:1,width:2,color:o.BLACK};s(A,{title:{position:o.TOP},labels:{visible:!0,margin:{left:8,right:8},padding:0,border:{width:0},paintOrder:"stroke",stroke:{lineJoin:"round",width:1},offset:{left:0,top:0}},nodes:{width:24,padding:16,opacity:1,align:"stretch",offset:{left:0,top:0},focusHighlight:t.extend({},P),labels:{ariaTemplate:function(t){return t.node.label.text}}},links:{colorType:"static",opacity:.4,highlight:{opacity:.8,inactiveOpacity:.2},focusHighlight:t.extend({},P),labels:{ariaTemplate:function(t){var e=t.link;return e.source.label.text+" to "+e.target.label.text}}},tooltip:{followPointer:!1,delay:200}});kendo.deepExtend(kendo.dataviz,{Sankey:A,createSankeyData:function(t,e,i){var o=new Set,n=new Map,r=new Map;t.forEach((function(t){e.forEach((function(e){o.add(e.value(t))}));for(var s=0;s<e.length-1;s++){var a=e[s].value(t),l=e[s+1].value(t),h=a+"_"+l,u=i.value(t),c=n.get(h);void 0!==c?n.set(h,c+u):(n.set(h,u),r.set(h,{source:a,target:l}))}}));var s=new Map,a=Array.from(o).map((function(t,e){return s.set(t,e),{id:e,label:{text:String(t)}}})),l=Array.from(n).map((function(t){var e=t[0],i=t[1],o=r.get(e),n=o.source,a=o.target;return{sourceId:s.get(n),targetId:s.get(a),value:i}}));return{nodes:a,links:l}}})}(window.kendo.jQuery),function(t){var e=window.kendo,i=e.ui.Widget,o=e.htmlEncode,n="__style",r=`${n}="display: flex; align-items: center;"`,s=t=>`<span ${n}="margin: 0 3px">${t}</span>`,a=t=>`<div ${n}="width: 15px; height: 15px; background-color: ${t}; display: inline-flex; margin-left: 3px"></div>`,l={node:function({dataItem:t,value:e}){const{color:i,label:n}=t;return`<div ${r}>\n                    ${a(i)}\n                    ${s(o(n.text))}\n                    ${s(e)}\n                </div>`},link:function({dataItem:t,value:i,rtl:n}){const{source:l,target:h}=t;return`<div ${r}>\n                    ${a(l.color)}\n                    ${s(o(l.label.text))}\n                    ${s(e.ui.icon({icon:n?"arrow-left":"arrow-right"}))}\n                    ${a(h.color)}\n                    ${s(o(h.label.text))}\n                    ${s(i)}\n                </div>`}},h=i.extend({init:function(t,e){this.options=e,i.fn.init.call(this,t),e.rtl&&this.element.addClass("k-rtl"),this.element.addClass("k-tooltip k-chart-tooltip k-chart-shared-tooltip").append('<div class="k-tooltip-content"></div>')},size:function(){return{width:this.element.outerWidth(),height:this.element.outerHeight()}},setContent:function(t){this.element.find(".k-tooltip-content").html(t),this.element.find(`[${n}]`).each(((t,e)=>{e.getAttribute(n).split(";").filter((t=>""!==t)).forEach((t=>{const i=t.split(":");e.style[i[0].trim()]=i[1].trim()})),e.removeAttribute(n)}))},setPosition:function(t,e,i){const o=this.size(),n={...e};n.left+="left"===t.horizontal?i:-1*i,"right"===t.horizontal&&(n.left-=o.width),"bottom"===t.vertical?n.top-=o.height+i:n.top+=i,this.element.css(n)},show:function(){this.element.show()},hide:function(){this.element.hide()},destroy:function(){this.element.remove()}});e.deepExtend(e.dataviz,{SankeyTooltip:{Tooltip:h,ContentTemplates:l}})}(window.kendo.jQuery),function(t){const e=window.kendo,i=e.template,o=e.ui.Widget,n=e.dataviz,r=n.defined,s=e.htmlEncode,a=e.support.isRtl,l=n.Sankey,{Tooltip:h,ContentTemplates:u}=n.SankeyTooltip,c=o.extend({init:function(i,r){e.destroy(i),t(i).empty(),this.options=e.deepExtend({},this.options,r,{rtl:a(i)}),this._parseAriaLabelTemplates(this.options),o.fn.init.call(this,i),this.wrapper=this.element,this._initSankey(),this._attachEvents(),e.notify(this,n.ui),this._showWatermarkOverlay&&this._showWatermarkOverlay(this.wrapper[0])},setOptions:function(t){var i=this.options;this.events.forEach((t=>{i[t]&&this.unbind(t,i[t])}));const o=e.deepExtend(t,{rtl:a(this.element)});this._parseAriaLabelTemplates(o),this._instance.setOptions(o),this.bind(this.events,this._instance.options)},_initSankey:function(){const t=this._getThemeOptions(this.options),{seriesColors:e,axisDefaults:i,seriesDefaults:o,legend:n,title:r}=t,{line:s,labels:a}=i,l=o.labels.background;this._createSankey(this.options,{nodeColors:e,links:s,labels:{...a,stroke:{color:l}},legend:n,title:r}),this.options=this._instance.options},_createSankey:function(t,e){this._instance=new l(this.element[0],t,e)},_getThemeOptions:function(t){var e=(t||{}).theme;if(e&&-1!==n.SASS_THEMES.indexOf(e.toLowerCase()))return n.autoTheme().chart;if(r(e)){var i=n.ui.themes||{};return(i[e]||i[e.toLowerCase()]||{}).chart||{}}},_parseAriaLabelTemplates:function(t){const{nodes:e,links:o}=t;e&&e.labels&&e.labels.ariaTemplate&&(e.labels.ariaTemplate=i(e.labels.ariaTemplate)),o&&o.labels&&o.labels.ariaTemplate&&(o.labels.ariaTemplate=i(o.labels.ariaTemplate))},_attachEvents:function(){this.events.forEach((t=>{this._instance.bind(t,(e=>{this._events[t]&&this._events[t].forEach((t=>t.call(void 0,e)))}))})),this._instance.bind("tooltipShow",this.tooltipShow.bind(this)),this._instance.bind("tooltipHide",this.tooltipHide.bind(this))},tooltipShow:function(o){const{tooltip:n,rtl:a}=this.options,{nodeTemplate:l,linkTemplate:c,offset:d}=n;if(!this._tooltip){const e=this.element[0].ownerDocument;this._tooltip=new h(e.createElement("div"),{rtl:a});const{appendTo:i=e.body}=this.options.tooltip;this._tooltip.element.appendTo(t(i))}const p=i(("node"===o.targetType?l:c)||u[o.targetType]),f=s(e.format(this.options.messages.tooltipUnits,r(o.nodeValue)?o.nodeValue:o.dataItem.value));this._tooltip.setContent(p({dataItem:o.dataItem,value:f,rtl:a})),this._tooltip.setPosition(o.tooltipData.popupAlign,o.tooltipData.popupOffset,d),this._tooltip.show()},tooltipHide:function(){this._tooltip&&(this._tooltip.destroy(),this._tooltip=null)},exportVisual:function(t){return this._instance.exportVisual(t)},destroy:function(){o.fn.destroy.call(this),this.tooltipHide(),this._instance.destroy(),this._instance=null},events:["nodeClick","linkClick","nodeEnter","nodeLeave","linkEnter","linkLeave"],options:{name:"Sankey",theme:"default",tooltip:{offset:12},messages:{tooltipUnits:"({0} Units)"}}});n.ExportMixin.extend(c.fn),e.PDFMixin&&e.PDFMixin.extend(c.fn),n.ui.plugin(c),e.deepExtend(n,{Sankey:c})}(window.kendo.jQuery);return kendo}));
//# sourceMappingURL=kendo.dataviz.sankey.min.js.map
