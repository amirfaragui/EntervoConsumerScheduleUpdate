{"version":3,"file":"kendo.pivot.common.min.js","names":["factory","define","amd","window","kendo","pivotgrid","common","exports","filterFunctionFormats","contains","doesnotcontain","endswith","eq","neq","startswith","operators","in","serializeExpression","expression","command","value","String","field","operator","str","values","_i","arguments","length","forEach","index","replace","RegExp","concat","formatString","serializeMembers","members","measures","sort","hasKpiMeasures","memberName","parsed","found","expanded","child","root","idx","member","name_1","name","push","hierarchyName","baseHierarchyPath","j","l","indexOf","expand","parseDescriptors","rootNames","some","n","getRootNames","crossJoinCommands","names","crossJoinCommand","mapNames","expandMemberDescriptor","join","measureNames","measure","result","undefined","rootLength","slice","name_2","rootName","tmp","crossJoin","sortDescriptor","length_1","sortDescriptorForMember","dir","parts","split","pop","shift","createRequestBody","options","_a","columnAxes","_b","rowAxes","_c","measureAxes","_d","_e","filter","measuresRowAxis","measuresAxis","hasKpi","i","Boolean","type","isArray","checkForKpiMeasures","filters","cube","current","serializeFilters","connection","catalog","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","__extends","TypeError","__","this","constructor","create","__assign","assign","t","s","apply","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","step","next","e","rejected","done","then","__generator","body","f","y","g","_","label","sent","trys","ops","verb","throw","return","Symbol","iterator","v","op","__spreadArray","to","from","pack","ar","parseResponse","response","xmlDoc","DOMParser","parseFromString","axes","querySelectorAll","cells","map","cell","fmtValue","getPropertyValue","ordinal","parseInt","getAttribute","columns","tuples","rows","data","axis","tuple","lNum","hasChildren","caption","children","hierarchy","levelName","levelNum","parentName","translateAxis","indexedData","fill","c","counter","rowTuple","colTuple","columnTuple","node","querySelector","textContent","discoverCommands","schemaCatalogs","schemaCubes","schemaDimensions","schemaHierarchies","schemaKPIs","schemaLevels","schemaMeasures","schemaMembers","createDiscoverBody","properties","serializeOptions","restrictions","Catalog","parentTagName","capitalize","key","toUpperCase","discoverParser","row","description","defaultHierarchy","uniqueName","dimensionUniqueName","displayFolder","origin","defaultMember","goal","status","trend","statusGraphic","trendGraphic","groupName","orderingProperty","hierarchyUniqueName","aggregator","defaultFormat","levelUniqueName","childrenCardinality","isMeasure","getMaxNesting","set","Set","add","size","getMaxExpansion","generateNormalizedPath","parent","normalizedPath","toMatrix","rowIndex","colIndex","maxDepth","maxBreadth","matrix","leafs","branchDepth","branchBreadth","depth","breadth","matrixResult","leafsResult","findIndex","level","inject","total","path","splice","collOffset","newMatrix","newLeafs","childBreadth","withTotal","alt","childIndex","childHierarchy","copy","obj","JSON","parse","stringify","kpiMeasure","kpi","buildKPIMeasures","HEADERS_ACTION","compareAxisWithField","a","compareAxes","filterField","out","_loop_2","startsWith","duplicatedAxisIndex","ax","insertAxis","toInsert","state","dropTarget","dropDirection","offset","reverseColumnsByMeasures","firstColumn","lastMember","columnsArr","measuresCount","col","result_1","arr","reverse","PIVOT_CONFIGURATOR_ACTION","findPath","matchFn","matched","match","h","headersReducer","action","toggle","existing","find","payload","collapse","existing_1","nextState","filtered_1","tree","configuratorReducer","newRows","newColumns","newMeasures","newSort","newFilter","newDragitem","newDropZone","newDropDirection","newDropTarget","toggleSelection","payload_1","removeMeasureAxis","addMeasureAxis","every","m","removeMeasureAxes","addMeasureAxes","removeColumnAxis","removeRowAxis","addColumnAxis","addRowAxis","addColumnAxes","removeColumnAxes","addRowAxes","removeRowAxes","remove","setDragItem","setDropZone","setDropTarget","setDropDirection","drop","dragItem","dropZone","currentColumn","currentRow","currentMeasure","setSort","setFilter","addFilter","changeFilter","removeFilter","minAggregate","init","min","Number","POSITIVE_INFINITY","merge","src","dest","Math","accumulate","acc","isFinite","NaN","format","toFixed","maxAggregate","max","NEGATIVE_INFINITY","isPresent","isBlank","isFunction","isString","isNotNullOrEmptyString","trim","isNullOrEmptyString","isDate","getTime","ifElse","predicate","right","left","compose","args","reduceRight","curr","getterCache","FIELD_REGEX","what","getter","safe","fields","indexAccessor","pairwise","empty","formatDescriptors","accessor","formatter","sanitizeDateLiterals","removeAfterDot","directionFormatter","take","aggregates","group","formatSort","formatGroup","formatAggregates","aggregate","formatDateValue","date","Date","UTC","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","getMilliseconds","skip","floor","transformSort","isNotEmptyArray","filterFormatter","x","ignoreCase","FilterOperator","target","convert","mapper","keys","reduce","bind","translateAggregate","source","toLowerCase","translateAggregates","valueOrDefault","defaultValue","translateGroup","hasSubgroups","items","Aggregates","Member","HasSubgroups","Items","Key","logic","or","fn","identity","and","operatorsMap","doesnotendwith","doesnotstartwith","lastIndexOf","gt","gte","isempty","isnotempty","isnotnull","isnull","lt","lte","dateRegExp","typedGetter","prop","exec","isNaN","parseFloat","isNumeric","transformFilter","itemProp","convertValue","transformCompositeFilter","combiner","forEachDesc","desc","callbackfn","filterFields","callback","initializeFiltering","descriptor","compositeFilter","fieldValues","hasFilter","filteringAxes","filteringFields_1","subNode","initialNode","childNode","get","Map","splitKeyValue","keyValue","separatorIndex","substring","calculateColumnData","dataField","k","childData_1","parentData_1","mergeTrees","srcChild","destChild","calculateColumns","columnsData","srcColumns","destColumns","createPath","caption_1","membersNode","axisSettings","cache","cacheData","has","currentLevel","currentLevelNode","levelField_1","_loop_1","item","newDest","currentPath","readData","dataTree","rowTuples","columnTuples","columnSettings","rowSettings","rowsCache","rowNode","rowColumnsNode","measuresMember_1","colNode","mergeData","exclude","rootFields","definitions","createTuples","axesSettings","sortDescriptors","excludeFields","parentFields","flatMembers","topTuple","allTuple","topField","getTopMembersTuple","currDef","axe","keysToAdd","currDefMembers","element","delete","nodeData","curLevel_1","childrenByKeys","order","sortableA","sortValue","sortableB","sortFunc","leafValue","leafTuple","axisCaption","curCaption","measureToMember","addMeasure","measureMember","tupleCopy","addMultipleMeasures","tupleWithMeasure","Navigation","tabIndex","eventHandlers","update","defineProperty","selectors","enumerable","configurable","all","elements","el","matches","start","_this","eventType","this_1","mouseEvents","ev","Element","closest","addEventListener","this_2","keyboardEvents","stop","removeEventListener","focusElement","previous","removeAttribute","classList","setAttribute","focus","preventScroll","scrollableValuesSel","scrollableColumnHeaderSel","scrollableRowHeaderSel","emptyCellSel","tableSel","cellSel","scrollables","selectors$1","onEnter","nav","icon","index_1","click","preventDefault","tryScrollLeft","scrollable","elToScroll","offsetLeft","scrollLeft","tryScrollRight","offsetWidth","tryScrollUp","scrollTop","offsetTop","tryScrollDown","offsetHeight","scrollTo","scrollFunc","scroll","tableMap","table","colsCount","colSpan","prev","cur","r","curColSpan","colSp","rowSp","rowSpan","ind","val","curInd","navigationMap","columnHeader","rowHeader","emptyCell","emptyCellRow","ctrlKey","metaKey","cellAt","pos","targetPos","getTargetPos","nextPos","keyboardEvents$1","keydown","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","o","_target","_ev","nextElementSibling","HTMLElement","setTimeout","parentNode","confHeader","Enter","Space","Home","ro","End","mouseEvents$1","hasAttribute","PivotGridNavigation","_super","navigate","onDelete","Tab","shiftKey","Escape","pivot","previousElementSibling","confButton","pivotCell","Delete","Backspace","ConfiguratorNavigation","addKPI","averageAggregate","sumA","count","cloneDataTree","countAggregate","countA","_value","createAxisDescriptors","expandTree","descriptors","createDataState","createDataTree","leafNodes","dataItem","filteringDataItem_1","displayValue","dataKey","node_1","eachAxis","leaf","createFlatSchemaDimensions","dimensions","dim","createLocalDataState","colTuples","fetchData","fetchOptions","headers","method","fetch","url","text","fetchDiscover","stringResponse","sumAggregate","sum","toColumns","toData","hash","membersNames","columnsIndexes","rowsIndexes","colMembers","rowMembers","toRows","rotateMatrix","toTree","tupleIndex","memberIndex","parent_1","parentKey","intruderIndex"],"sources":["kendo.pivot.common.js"],"mappings":"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","sourcesContent":["(function (factory) {\n    typeof define === 'function' && define.amd ? define(['kendo.core'], factory) :\n    factory();\n})((function () {\n    (function () {\n\n    window.kendo.pivotgrid = window.kendo.pivotgrid || {};\n    window.kendo.pivotgrid.common = (function (exports) {\n        \n\n        var filterFunctionFormats = {\n            contains: \", InStr({0}.CurrentMember.MEMBER_CAPTION,\\\"{1}\\\") > 0\",\n            doesnotcontain: \", InStr({0}.CurrentMember.MEMBER_CAPTION,\\\"{1}\\\")\",\n            endswith: \", Right({0}.CurrentMember.MEMBER_CAPTION,Len(\\\"{1}\\\"))=\\\"{1}\\\"\",\n            eq: \", {0}.CurrentMember.MEMBER_CAPTION = \\\"{1}\\\"\",\n            neq: \", {0}.CurrentMember.MEMBER_CAPTION = \\\"{1}\\\"\",\n            startswith: \", Left({0}.CurrentMember.MEMBER_CAPTION,Len(\\\"{1}\\\"))=\\\"{1}\\\"\"\n        };\n        var operators = {\n            doesnotcontain: 'doesnotcontain',\n            in: 'in',\n            neq: \"neq\"\n        };\n        /**\n         * @hidden\n         */\n        function serializeFilters(filters, cube) {\n            var command = \"\";\n            var current = \"\";\n            for (var idx = filters.length - 1; idx >= 0; idx--) {\n                current = \"SELECT (\";\n                current += serializeExpression(filters[idx]);\n                current += \") ON 0\";\n                if (idx === filters.length - 1) {\n                    current += \" FROM [\" + cube + \"]\";\n                    command = current;\n                }\n                else {\n                    command = current + \" FROM ( \" + command + \" )\";\n                }\n            }\n            return command;\n        }\n        function serializeExpression(expression) {\n            var command = '';\n            var value = String(expression.value);\n            var field = expression.field;\n            var operator = expression.operator;\n            if (operator === operators.in) {\n                command += \"{\";\n                command += value;\n                command += \"}\";\n            }\n            else {\n                command += operator === operators.neq || operator === operators.doesnotcontain ? '-' : '';\n                command += \"Filter(\";\n                command += field + \".MEMBERS\";\n                command += formatString(filterFunctionFormats[operator], field, value);\n                command += \")\";\n            }\n            return command;\n        }\n        function formatString(str) {\n            var values = [];\n            for (var _i = 1; _i < arguments.length; _i++) {\n                values[_i - 1] = arguments[_i];\n            }\n            values.forEach(function (value, index) {\n                str = str.replace(new RegExp(\"\\\\{\".concat(index, \"\\\\}\"), 'g'), value);\n            });\n            return str;\n        }\n\n        /**\n         * @hidden\n         */\n        function checkForKpiMeasures(measures) {\n            let hasKpi = false;\n            for(let i = 0; i < measures.length; i++) {\n               hasKpi = Boolean(measures[i].type);\n               if (hasKpi) {\n                    break;\n               }\n            }\n\n            return measures.length >= 1 && isArray(measures) && hasKpi;\n        }\n\n\n        /**\n         * @hidden\n         */\n        function serializeMembers(members, measures, sort, hasKpiMeasures) {\n            var command = \"\";\n            members = members || [];\n            var parsed = parseDescriptors(members);\n            var expanded = parsed.expanded;\n            var rootNames = getRootNames(parsed.root);\n            var crossJoinCommands = [];\n            var length = expanded.length;\n            var idx = 0;\n            var memberName;\n            var names = [];\n            if (rootNames.length > 1 || measures.length > 1 || hasKpiMeasures) {\n                crossJoinCommands.push(crossJoinCommand(rootNames, measures, hasKpiMeasures));\n                for (; idx < length; idx++) {\n                    memberName = expandMemberDescriptor(expanded[idx].name, sort);\n                    names = mapNames(memberName, rootNames);\n                    crossJoinCommands.push(crossJoinCommand(names, measures, hasKpiMeasures));\n                }\n                command += crossJoinCommands.join(\",\");\n            }\n            else {\n                for (; idx < length; idx++) {\n                    memberName = expandMemberDescriptor(expanded[idx].name, sort);\n                    names.push(memberName[0]);\n                }\n                command += rootNames.concat(names).join(\",\");\n            }\n            return command;\n        }\n        /**\n         * @hidden\n         */\n        function measureNames(measures) {\n            var length = measures.length;\n            var result = [];\n            var measure;\n            for (var idx = 0; idx < length; idx++) {\n                measure = measures[idx];\n                result.push(measure.name !== undefined ? measure.name : measure);\n            }\n            return result;\n        }\n        function getRootNames(members) {\n            var root = [];\n            members.forEach(function (member) {\n                var name = member.name[0];\n                var hierarchyName = baseHierarchyPath(name);\n                if (!root.some(function (n) { return n.indexOf(hierarchyName) === 0; })) {\n                    root.push(name);\n                }\n            });\n            return root;\n        }\n        function parseDescriptors(members) {\n            var expanded = [];\n            var child = [];\n            var root = [];\n            var idx = 0;\n            var found;\n            for (; idx < members.length; idx++) {\n                var member = members[idx];\n                var name_1 = member.name;\n                found = false;\n                if (name_1.length > 1) {\n                    child.push(member);\n                }\n                else {\n                    var hierarchyName = baseHierarchyPath(name_1[0]);\n                    for (var j = 0, l = root.length; j < l; j++) {\n                        if (root[j].name[0].indexOf(hierarchyName) === 0) {\n                            found = true;\n                            break;\n                        }\n                    }\n                    if (!found) {\n                        root.push(member);\n                    }\n                    if (member.expand) {\n                        expanded.push(member);\n                    }\n                }\n            }\n            expanded = expanded.concat(child);\n            return {\n                expanded: expanded,\n                root: root\n            };\n        }\n        function mapNames(names, rootNames) {\n            var rootLength = rootNames.length;\n            rootNames = rootNames.slice(0);\n            for (var idx = 0; idx < names.length; idx++) {\n                var name_2 = names[idx];\n                for (var j = 0; j < rootLength; j++) {\n                    var rootName = baseHierarchyPath(rootNames[j]);\n                    if (name_2.indexOf(rootName) !== -1) {\n                        rootNames[j] = name_2;\n                        break;\n                    }\n                }\n            }\n            return rootNames;\n        }\n        function crossJoinCommand(members, measures, hasKpiMeasures) {\n            var tmp = members.slice(0);\n\n            if (measures.length > 1 || hasKpiMeasures) {\n                tmp.push(\"{\" + measureNames(measures).join(\",\") + \"}\");\n            }\n            return crossJoin(tmp);\n        }\n        function expandMemberDescriptor(names, sort) {\n            var idx = names.length - 1;\n            var name = names[idx];\n            var sortDescriptor = sortDescriptorForMember(sort, name);\n            if (sortDescriptor && sortDescriptor.dir) {\n                name = \"ORDER(\" + name + \".Children,\" + sortDescriptor.field + \".CurrentMember.MEMBER_CAPTION,\" + sortDescriptor.dir + \")\";\n            }\n            else {\n                name += \".Children\";\n            }\n            names[idx] = name;\n            return names;\n        }\n        function sortDescriptorForMember(sort, member) {\n            for (var idx = 0, length_1 = sort.length; idx < length_1; idx++) {\n                if (member.indexOf(sort[idx].field) === 0) {\n                    return sort[idx];\n                }\n            }\n            return null;\n        }\n        function baseHierarchyPath(memberName) {\n            var parts = memberName.split(\".\");\n            if (parts.length > 2) {\n                return parts[0] + \".\" + parts[1];\n            }\n            return memberName;\n        }\n        function crossJoin(names) {\n            var result = \"CROSSJOIN({\";\n            var name;\n            if (names.length > 2) {\n                name = names.pop();\n                result += crossJoin(names);\n            }\n            else {\n                result += names.shift();\n                name = names.pop();\n            }\n            result += \"},{\";\n            result += name;\n            result += \"})\";\n            return result;\n        }\n\n        /**\n         * @hidden\n         */\n        function createRequestBody(options) {\n            var command = '<Envelope xmlns=\"http://schemas.xmlsoap.org/soap/envelope/\"><Header/><Body><Execute xmlns=\"urn:schemas-microsoft-com:xml-analysis\"><Command><Statement>';\n            var _a = options.columnAxes, columnAxes = _a === void 0 ? [] : _a, _b = options.rowAxes, rowAxes = _b === void 0 ? [] : _b;\n            var _c = options.measureAxes, measureAxes = _c === void 0 ? [] : _c, _d = options.sort, sort = _d === void 0 ? [] : _d, _e = options.filter, filter = _e === void 0 ? [] : _e;\n            var measuresRowAxis = options.measuresAxis === \"rows\";\n            \n            const hasKpiMeasures = checkForKpiMeasures(measureAxes);\n\n            command += \"SELECT NON EMPTY {\";\n            if (!columnAxes.length && rowAxes.length && (!measureAxes.length || (measureAxes.length && measuresRowAxis))) {\n                columnAxes = rowAxes;\n                rowAxes = [];\n                measuresRowAxis = false;\n            }\n            if (!columnAxes.length && !rowAxes.length) {\n                measuresRowAxis = false;\n            }\n            if (columnAxes.length) {\n                command += serializeMembers(columnAxes, !measuresRowAxis ? measureAxes : [], sort, hasKpiMeasures);\n            }\n            else if (measureAxes.length && !measuresRowAxis) {\n                command += measureNames(measureAxes).join(\",\");\n            }\n            command += \"} DIMENSION PROPERTIES CHILDREN_CARDINALITY, PARENT_UNIQUE_NAME ON COLUMNS\";\n            if (rowAxes.length || (measuresRowAxis && measureAxes.length > 1)) {\n                command += \", NON EMPTY {\";\n                if (rowAxes.length) {\n                    command += serializeMembers(rowAxes, measuresRowAxis ? measureAxes : [], sort);\n                }\n                else {\n                    command += measureNames(measureAxes).join(\",\");\n                }\n                command += \"} DIMENSION PROPERTIES CHILDREN_CARDINALITY, PARENT_UNIQUE_NAME ON ROWS\";\n            }\n            if (filter.length) {\n                command += \" FROM \";\n                command += \"(\";\n                command += serializeFilters(filter, options.connection.cube);\n                command += \")\";\n            }\n            else {\n                command += \" FROM [\" + options.connection.cube + \"]\";\n            }\n            if (measureAxes.length === 1 && !hasKpiMeasures && columnAxes.length) {\n                command += \" WHERE (\" + measureNames(measureAxes).join(\",\") + \")\";\n            }\n            command += '</Statement></Command><Properties><PropertyList><Catalog>' + options.connection.catalog + '</Catalog><Format>Multidimensional</Format></PropertyList></Properties></Execute></Body></Envelope>';\n            return command.replace(/&/g, \"&amp;\");\n        }\n\n        /******************************************************************************\n        Copyright (c) Microsoft Corporation.\n\n        Permission to use, copy, modify, and/or distribute this software for any\n        purpose with or without fee is hereby granted.\n\n        THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\n        REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\n        AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\n        INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\n        LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\n        OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\n        PERFORMANCE OF THIS SOFTWARE.\n        ***************************************************************************** */\n        /* global Reflect, Promise */\n\n        var extendStatics = function(d, b) {\n            extendStatics = Object.setPrototypeOf ||\n                ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n                function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n            return extendStatics(d, b);\n        };\n\n        function __extends(d, b) {\n            if (typeof b !== \"function\" && b !== null)\n                throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n            extendStatics(d, b);\n            function __() { this.constructor = d; }\n            d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n        }\n\n        var __assign = function() {\n            __assign = Object.assign || function __assign(t) {\n                for (var s, i = 1, n = arguments.length; i < n; i++) {\n                    s = arguments[i];\n                    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n                }\n                return t;\n            };\n            return __assign.apply(this, arguments);\n        };\n\n        function __awaiter(thisArg, _arguments, P, generator) {\n            function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n            return new (P || (P = Promise))(function (resolve, reject) {\n                function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n                function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n                function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n                step((generator = generator.apply(thisArg, _arguments || [])).next());\n            });\n        }\n\n        function __generator(thisArg, body) {\n            var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n            return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n            function verb(n) { return function (v) { return step([n, v]); }; }\n            function step(op) {\n                if (f) throw new TypeError(\"Generator is already executing.\");\n                while (_) try {\n                    if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n                    if (y = 0, t) op = [op[0] & 2, t.value];\n                    switch (op[0]) {\n                        case 0: case 1: t = op; break;\n                        case 4: _.label++; return { value: op[1], done: false };\n                        case 5: _.label++; y = op[1]; op = [0]; continue;\n                        case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                        default:\n                            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                            if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                            if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                            if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                            if (t[2]) _.ops.pop();\n                            _.trys.pop(); continue;\n                    }\n                    op = body.call(thisArg, _);\n                } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n                if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n            }\n        }\n\n        function __spreadArray(to, from, pack) {\n            if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n                if (ar || !(i in from)) {\n                    if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n                    ar[i] = from[i];\n                }\n            }\n            return to.concat(ar || Array.prototype.slice.call(from));\n        }\n\n        /**\n         * @hidden\n         */\n        function parseResponse(response) {\n            var xmlDoc = new DOMParser().parseFromString(response, \"text/xml\");\n            var axes = Array.from(xmlDoc.querySelectorAll(\"Axis\"));\n            var cells = Array.from(xmlDoc.querySelectorAll(\"CellData > Cell\"))\n                .map(function (cell) { return ({\n                fmtValue: getPropertyValue(cell, \"FmtValue\"),\n                ordinal: parseInt(cell.getAttribute(\"CellOrdinal\"), 10),\n                value: getPropertyValue(cell, \"Value\")\n            }); });\n            var columns = { tuples: [] };\n            var rows = { tuples: [] };\n            var data = [];\n            axes.forEach(function (axis) {\n                if (axis.getAttribute('name') !== \"SlicerAxis\") {\n                    var tuples = columns.tuples.length === 0 ? columns.tuples : rows.tuples;\n                    Array.prototype.push.apply(tuples, translateAxis(axis));\n                }\n            });\n            var indexedData = new Array(rows.tuples.length * columns.tuples.length).fill(null);\n            cells.forEach(function (c) { indexedData[c.ordinal] = c; });\n            var counter = 0;\n            rows.tuples.forEach(function (rowTuple) {\n                columns.tuples.forEach(function (colTuple) {\n                    data.push({\n                        columnTuple: colTuple,\n                        data: indexedData[counter],\n                        rowTuple: rowTuple\n                    });\n                    counter++;\n                });\n            });\n            return { columns: columns, data: data, rows: rows };\n        }\n        /**\n         * @hidden\n         */\n        function getPropertyValue(member, name) {\n            var node = member.querySelector(name);\n            return node ? node.textContent : \"\";\n        }\n        function translateAxis(axis) {\n            var tuples = Array.from(axis.querySelectorAll(\"Tuple\"));\n            return tuples.map(function (tuple) {\n                var memberElements = Array.from(tuple.querySelectorAll(\"Member\"));\n                var members = memberElements.map(function (member) {\n                    var lNum = parseInt(getPropertyValue(member, \"LNum\") || \"0\", 10);\n                    var hasChildren = parseInt(getPropertyValue(member, \"CHILDREN_CARDINALITY\") || \"0\", 10) > 0;\n                    return {\n                        caption: getPropertyValue(member, \"Caption\"),\n                        children: [],\n                        hasChildren: hasChildren,\n                        hierarchy: member.getAttribute('Hierarchy'),\n                        levelName: getPropertyValue(member, \"LName\"),\n                        levelNum: lNum,\n                        name: getPropertyValue(member, \"UName\"),\n                        parentName: getPropertyValue(member, \"PARENT_UNIQUE_NAME\")\n                    };\n                });\n                return { members: members };\n            });\n        }\n\n        /**\n         * @hidden\n         */\n        var discoverCommands = {\n            schemaCatalogs: \"DBSCHEMA_CATALOGS\",\n            schemaCubes: \"MDSCHEMA_CUBES\",\n            schemaDimensions: \"MDSCHEMA_DIMENSIONS\",\n            schemaHierarchies: \"MDSCHEMA_HIERARCHIES\",\n            schemaKPIs: \"MDSCHEMA_KPIS\",\n            schemaLevels: \"MDSCHEMA_LEVELS\",\n            schemaMeasures: \"MDSCHEMA_MEASURES\",\n            schemaMembers: \"MDSCHEMA_MEMBERS\"\n        };\n        /**\n         * @hidden\n         */\n        function createDiscoverBody(options) {\n            var properties = {};\n            var command = '<Envelope xmlns=\"http://schemas.xmlsoap.org/soap/envelope/\"><Header/><Body><Discover xmlns=\"urn:schemas-microsoft-com:xml-analysis\">';\n            command += \"<RequestType>\" + (discoverCommands[options.command] || options.command) + \"</RequestType>\";\n            command += \"<Restrictions>\" + serializeOptions(\"RestrictionList\", options.restrictions, true) + \"</Restrictions>\";\n            if (options.connection && options.connection.catalog) {\n                properties.Catalog = options.connection.catalog;\n            }\n            command += \"<Properties>\" + serializeOptions(\"PropertyList\", properties, false) + \"</Properties>\";\n            command += '</Discover></Body></Envelope>';\n            return command;\n        }\n        function serializeOptions(parentTagName, options, capitalize) {\n            var result = \"\";\n            if (options) {\n                result += \"<\" + parentTagName + \">\";\n                var value = void 0;\n                for (var key in options) {\n                    if (options[key]) {\n                        value = options[key];\n                        if (capitalize) {\n                            key = key.replace(/([A-Z]+(?=$|[A-Z][a-z])|[A-Z]?[a-z]+)/g, \"$1_\").toUpperCase().replace(/_$/, \"\");\n                        }\n                        result += \"<\" + key + \">\" + value + \"</\" + key + \">\";\n                    }\n                }\n                result += \"</\" + parentTagName + \">\";\n            }\n            else {\n                result += \"<\" + parentTagName + \"/>\";\n            }\n            return result;\n        }\n\n        /**\n         * @hidden\n         */\n        function parseCubes(response) {\n            var xmlDoc = new DOMParser().parseFromString(response, \"text/xml\");\n            var rows = Array.from(xmlDoc.querySelectorAll(\"DiscoverResponse > return > root > row\"))\n                .map(function (row) { return ({\n                name: getPropertyValue(row, \"CUBE_NAME\"),\n                caption: getPropertyValue(row, \"CUBE_CAPTION\"),\n                description: getPropertyValue(row, \"DESCRIPTION\"),\n                type: getPropertyValue(row, \"CUBE_TYPE\")\n            }); });\n            return rows;\n        }\n        /**\n         * @hidden\n         */\n        function parseCatalogs(response) {\n            var xmlDoc = new DOMParser().parseFromString(response, \"text/xml\");\n            var rows = Array.from(xmlDoc.querySelectorAll(\"DiscoverResponse > return > root > row\"))\n                .map(function (row) { return ({\n                name: getPropertyValue(row, \"CATALOG_NAME\"),\n                description: getPropertyValue(row, \"DESCRIPTION\")\n            }); });\n            return rows;\n        }\n        /**\n         * @hidden\n         */\n        function parseMeasures(response) {\n            var xmlDoc = new DOMParser().parseFromString(response, \"text/xml\");\n            var rows = Array.from(xmlDoc.querySelectorAll(\"DiscoverResponse > return > root > row\"))\n                .map(function (row) { return ({\n                name: getPropertyValue(row, \"MEASURE_NAME\"),\n                caption: getPropertyValue(row, \"MEASURE_CAPTION\"),\n                uniqueName: getPropertyValue(row, \"MEASURE_UNIQUE_NAME\"),\n                description: getPropertyValue(row, \"DESCRIPTION\"),\n                aggregator: getPropertyValue(row, \"MEASURE_AGGREGATOR\"),\n                groupName: getPropertyValue(row, \"MEASUREGROUP_NAME\"),\n                displayFolder: getPropertyValue(row, \"MEASURE_DISPLAY_FOLDER\"),\n                defaultFormat: getPropertyValue(row, \"DEFAULT_FORMAT_STRING\")\n            }); });\n            return rows;\n        }\n        /**\n         * @hidden\n         */\n        function parseKPIs(response) {\n            var xmlDoc = new DOMParser().parseFromString(response, \"text/xml\");\n            var rows = Array.from(xmlDoc.querySelectorAll(\"DiscoverResponse > return > root > row\"))\n                .map(function (row) { return ({\n                name: getPropertyValue(row, \"KPI_NAME\"),\n                uniqueName: getPropertyValue(row, \"KPI_NAME\"),\n                caption: getPropertyValue(row, \"KPI_CAPTION\"),\n                value: getPropertyValue(row, \"KPI_VALUE\"),\n                goal: getPropertyValue(row, \"KPI_GOAL\"),\n                status: getPropertyValue(row, \"KPI_STATUS\"),\n                trend: getPropertyValue(row, \"KPI_TREND\"),\n                statusGraphic: getPropertyValue(row, \"KPI_STATUS_GRAPHIC\"),\n                trendGraphic: getPropertyValue(row, \"KPI_TREND_GRAPHIC\"),\n                description: getPropertyValue(row, \"KPI_DESCRIPTION\"),\n                groupName: getPropertyValue(row, \"MEASUREGROUP_NAME\"),\n                type: \"kpi\"\n            }); });\n            return rows;\n        }\n        /**\n         * @hidden\n         */\n        function parseDimensions(response) {\n            var xmlDoc = new DOMParser().parseFromString(response, \"text/xml\");\n            var rows = Array.from(xmlDoc.querySelectorAll(\"DiscoverResponse > return > root > row\"))\n                .map(function (row) { return ({\n                caption: getPropertyValue(row, \"DIMENSION_CAPTION\"),\n                defaultHierarchy: getPropertyValue(row, \"DEFAULT_HIERARCHY\"),\n                description: getPropertyValue(row, \"DESCRIPTION\"),\n                name: getPropertyValue(row, \"DIMENSION_NAME\"),\n                type: parseInt(getPropertyValue(row, \"DIMENSION_TYPE\"), 10),\n                uniqueName: getPropertyValue(row, \"DIMENSION_UNIQUE_NAME\")\n            }); });\n            return rows;\n        }\n        /**\n         * @hidden\n         */\n        function parseHierarchies(response) {\n            var xmlDoc = new DOMParser().parseFromString(response, \"text/xml\");\n            var rows = Array.from(xmlDoc.querySelectorAll(\"DiscoverResponse > return > root > row\"))\n                .map(function (row) { return ({\n                name: getPropertyValue(row, \"HIERARCHY_NAME\"),\n                caption: getPropertyValue(row, \"HIERARCHY_CAPTION\"),\n                description: getPropertyValue(row, \"DESCRIPTION\"),\n                uniqueName: getPropertyValue(row, \"HIERARCHY_UNIQUE_NAME\"),\n                dimensionUniqueName: getPropertyValue(row, \"DIMENSION_UNIQUE_NAME\"),\n                displayFolder: getPropertyValue(row, \"HIERARCHY_DISPLAY_FOLDER\"),\n                origin: getPropertyValue(row, \"HIERARCHY_ORIGIN\"),\n                defaultMember: getPropertyValue(row, \"DEFAULT_MEMBER\")\n            }); });\n            return rows;\n        }\n        /**\n         * @hidden\n         */\n        function parseLevels(response) {\n            var xmlDoc = new DOMParser().parseFromString(response, \"text/xml\");\n            var rows = Array.from(xmlDoc.querySelectorAll(\"DiscoverResponse > return > root > row\"))\n                .map(function (row) { return ({\n                name: getPropertyValue(row, \"LEVEL_NAME\"),\n                caption: getPropertyValue(row, \"LEVEL_CAPTION\"),\n                description: getPropertyValue(row, \"DESCRIPTION\"),\n                uniqueName: getPropertyValue(row, \"LEVEL_UNIQUE_NAME\"),\n                dimensionUniqueName: getPropertyValue(row, \"DIMENSION_UNIQUE_NAME\"),\n                displayFolder: getPropertyValue(row, \"LEVEL_DISPLAY_FOLDER\"),\n                orderingProperty: getPropertyValue(row, \"LEVEL_ORDERING_PROPERTY\"),\n                origin: getPropertyValue(row, \"LEVEL_ORIGIN\"),\n                hierarchyUniqueName: getPropertyValue(row, \"HIERARCHY_UNIQUE_NAME\")\n            }); });\n            return rows;\n        }\n        /**\n         * @hidden\n         */\n        function parseMembers(response) {\n            var xmlDoc = new DOMParser().parseFromString(response, \"text/xml\");\n            var rows = Array.from(xmlDoc.querySelectorAll(\"DiscoverResponse > return > root > row\"))\n                .map(function (row) { return ({\n                name: getPropertyValue(row, \"MEMBER_NAME\"),\n                caption: getPropertyValue(row, \"MEMBER_CAPTION\"),\n                uniqueName: getPropertyValue(row, \"MEMBER_UNIQUE_NAME\"),\n                dimensionUniqueName: getPropertyValue(row, \"DIMENSION_UNIQUE_NAME\"),\n                hierarchyUniqueName: getPropertyValue(row, \"HIERARCHY_UNIQUE_NAME\"),\n                levelUniqueName: getPropertyValue(row, \"LEVEL_UNIQUE_NAME\"),\n                childrenCardinality: getPropertyValue(row, \"CHILDREN_CARDINALITY\")\n            }); });\n            return rows;\n        }\n\n        var discoverParser = {\n            schemaCatalogs: parseCatalogs,\n            schemaCubes: parseCubes,\n            schemaDimensions: parseDimensions,\n            schemaHierarchies: parseHierarchies,\n            schemaKPIs: parseKPIs,\n            schemaLevels: parseLevels,\n            schemaMeasures: parseMeasures,\n            schemaMembers: parseMembers\n        };\n        /**\n         * Fetches the data.\n         *\n         * @param options RequestOptions\n         * @returns Promise<ResponseData>\n         *\n         * @example\n         * const options: RequestOptions = { ... };\n         *\n         * fetchData(options).then(createDataState).then((dataState: DataState) => {\n         *  // Update the UI\n         * });\n         */\n        /**\n         * @hidden\n         */\n        var fetchData = function (fetchOptions, options) { return __awaiter(void 0, void 0, void 0, function () {\n            var init, response, stringResponse;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        init = __assign({ body: createRequestBody(options), headers: { 'Content-Type': 'text/xml' }, method: 'POST' }, fetchOptions.init);\n                        return [4 /*yield*/, fetch(fetchOptions.url, init)];\n                    case 1:\n                        response = _a.sent();\n                        return [4 /*yield*/, response.text()];\n                    case 2:\n                        stringResponse = _a.sent();\n                        return [2 /*return*/, parseResponse(stringResponse)];\n                }\n            });\n        }); };\n        /**\n         * @hidden\n         */\n        var fetchDiscover = function (fetchOptions, options) { return __awaiter(void 0, void 0, void 0, function () {\n            var init, response, stringResponse;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        init = __assign({ body: createDiscoverBody(options), headers: { 'Content-Type': 'text/xml' }, method: 'POST' }, fetchOptions.init);\n                        return [4 /*yield*/, fetch(fetchOptions.url, init)];\n                    case 1:\n                        response = _a.sent();\n                        return [4 /*yield*/, response.text()];\n                    case 2:\n                        stringResponse = _a.sent();\n                        return [2 /*return*/, discoverParser[options.command](stringResponse)];\n                }\n            });\n        }); };\n\n        var isMeasure = function (member) { return member.hierarchy === '[Measures]'; };\n        // A typical tree depth count won't work for the Pivot,\n        // as each branch can have lower number of nodes than the total number of levels\n        /**\n         * @hidden\n         */\n        var getMaxNesting = function (node, set) {\n            if (set === void 0) { set = new Set(); }\n            (node.children || []).forEach(function (child) {\n                set.add(child.levelName);\n                getMaxNesting(child, set);\n            });\n            return set.size;\n        };\n        /**\n         * @hidden\n         */\n        var getMaxExpansion = function (node) {\n            var expanded = 0;\n            (node.children || []).forEach(function (child) {\n                expanded += (getMaxExpansion(child) || 1);\n            });\n            return expanded;\n        };\n        /**\n         * @hidden\n         */\n        var generateNormalizedPath = function (node, parent) {\n            return (parent && (parent.hierarchy === node.hierarchy)\n                ? __spreadArray(__spreadArray([], (parent.normalizedPath || []).slice(0, -1), true), [node.name || null], false) : __spreadArray(__spreadArray([], ((parent && parent.normalizedPath) ? parent.normalizedPath : []), true), [node.name], false)).filter(Boolean);\n        };\n        /**\n         * @hidden\n         */\n        var generatePath = function (node, parent) {\n            return (parent && (parent.hierarchy === node.hierarchy)\n                ? __spreadArray(__spreadArray([], (parent.path || []).slice(0, -1), true), [((node.levelNum === 0 ? node.hierarchy : node.name) || null)], false) : __spreadArray(__spreadArray([], ((parent && parent.path) ? parent.path : []), true), [node.levelNum === 0 ? node.hierarchy : node.name], false)).filter(Boolean);\n        };\n        /**\n         * @hidden\n         */\n        var toMatrix = function (node, rowIndex, colIndex, maxDepth, maxBreadth, matrix, leafs, parent) {\n            if (rowIndex === void 0) { rowIndex = -1; }\n            if (colIndex === void 0) { colIndex = 0; }\n            if (maxDepth === void 0) { maxDepth = undefined; }\n            if (maxBreadth === void 0) { maxBreadth = undefined; }\n            if (matrix === void 0) { matrix = undefined; }\n            if (leafs === void 0) { leafs = undefined; }\n            if (parent === void 0) { parent = undefined; }\n            var branchDepth = getMaxNesting(node);\n            var branchBreadth = getMaxExpansion(node);\n            var depth = maxDepth || branchDepth;\n            var breadth = maxBreadth || branchBreadth;\n            var matrixResult = matrix ? matrix.slice() : [];\n            var leafsResult = leafs ? leafs.slice() : new Array(breadth);\n            var index = matrixResult.findIndex(function (l) { return l && l.name === node.levelName && l.level === node.levelNum; });\n            var level = matrixResult[index];\n            var row = {\n                name: node.levelName,\n                level: node.levelNum,\n                index: rowIndex,\n                cells: new Array(breadth).fill(null)\n            };\n            var inject = rowIndex !== -1 && colIndex !== -1;\n            var cell = {\n                caption: node.caption,\n                name: node.name,\n                levelName: node.levelName,\n                levelNum: node.levelNum,\n                hasChildren: node.hasChildren,\n                parentName: node.parentName,\n                hierarchy: node.hierarchy,\n                total: (node.total !== undefined ? node.total : false) || (parent && parent.children.length <= 1 && parent.total),\n                parent: parent,\n                rowIndex: rowIndex,\n                colIndex: colIndex,\n                depth: 1,\n                breadth: 1,\n                path: node.path || [],\n                normalizedPath: node.normalizedPath || [],\n                children: node.children.filter(function (c) { return c.hierarchy === node.hierarchy; })\n            };\n            if (inject) {\n                if (level) {\n                    level.cells[colIndex] = cell;\n                    if (level.index >= rowIndex) {\n                        rowIndex = level.index;\n                    }\n                }\n                else {\n                    if (matrixResult[rowIndex] && matrixResult[rowIndex].cells.length) {\n                        for (var idx = rowIndex; idx < matrixResult.length; idx++) {\n                            var shiftedRow = matrixResult[idx];\n                            shiftedRow.index++;\n                        }\n                        matrixResult.splice(rowIndex, 0, row);\n                        matrixResult[rowIndex].cells[colIndex] = cell;\n                    }\n                    else {\n                        matrixResult[rowIndex] = row;\n                        matrixResult[rowIndex].cells[colIndex] = cell;\n                    }\n                }\n            }\n            var collOffset = 0;\n            if (node.children && node.children.length) {\n                node.children.forEach(function (child) {\n                    var _a = toMatrix(child, rowIndex + 1, colIndex + collOffset, depth, breadth, matrixResult, leafsResult, cell), newMatrix = _a[0], newLeafs = _a[1], childBreadth = _a[3];\n                    collOffset += (childBreadth || 1);\n                    matrixResult = newMatrix.slice();\n                    leafsResult = newLeafs.slice();\n                });\n            }\n            else if (node.normalizedPath) {\n                leafsResult[colIndex] = { total: cell.total, path: node.normalizedPath };\n            }\n            cell.depth = branchDepth;\n            cell.breadth = branchBreadth;\n            return [\n                matrixResult,\n                leafsResult,\n                branchDepth,\n                branchBreadth\n            ];\n        };\n        var withTotal = function (root, parent, index) {\n            if (parent === void 0) { parent = null; }\n            if (index === void 0) { index = 0; }\n            var hierarchy;\n            var alt = __assign(__assign({}, root), { total: true, hasChildren: false, children: [] });\n            for (var childIndex = 0; childIndex < root.children.length; childIndex++) {\n                var child = withTotal(root.children[childIndex], root, childIndex);\n                hierarchy = hierarchy || child.hierarchy;\n                if (child.hierarchy !== hierarchy\n                    && parent\n                    && !parent.children.some(function (c) { return c.total && c.name === alt.name; })\n                    && !root.total) {\n                    alt.children.push(child);\n                    root.children.splice(childIndex, 1);\n                    childIndex--;\n                }\n            }\n            if (root.children.filter(function (c) { return !c.total; }).length >= 1\n                && parent\n                && !parent.children.some(function (c) { return c.total && c.name === alt.name; })\n                && !root.total) {\n                var childHierarchy = root.children[0].hierarchy;\n                if (root.hierarchy === childHierarchy) {\n                    parent.children.splice(index + 1, 0, alt);\n                }\n            }\n            return root;\n        };\n        /**\n         * @hidden\n         */\n        var toTree = function (tuples) {\n            var root = { children: [] };\n            var map = {};\n            if (tuples.every(function (t) { return t.members.length === 1 && isMeasure(t.members[0]); })) {\n                // toTree(columnsTuples) - The case where there are only measure(s) and no columns.\n                return {\n                    children: tuples.map(function (t) {\n                        var member = t.members[0];\n                        return __assign(__assign({}, member), { normalizedPath: [member.name], parentName: member.name, path: [member.hierarchy] });\n                    })\n                };\n            }\n            for (var tupleIndex = 0; tupleIndex < tuples.length; tupleIndex++) {\n                var tuple = copy(tuples[tupleIndex]);\n                var key = \"\";\n                var _loop_1 = function (memberIndex) {\n                    var member = tuple.members[memberIndex];\n                    var parent_1;\n                    if (root.children && root.children.length === 0) {\n                        parent_1 = root;\n                    }\n                    else if (map[key] && !map[key + member.name] && member.levelNum === 0) {\n                        parent_1 = map[key];\n                    }\n                    else if (map[key + member.parentName] && member.levelNum > 0 && !map[key + member.parentName + member.name]) {\n                        parent_1 = map[key + member.parentName];\n                    }\n                    else if (!map[key + member.parentName] && member.levelNum > 0 && !map[key + member.parentName + member.name]) {\n                        var parentKey = Object.keys(map).find(function (e) { return member.parentName === map[e].name; });\n                        if (parentKey) {\n                            parent_1 = map[parentKey];\n                        }\n                    }\n                    if (parent_1) {\n                        member.path = generatePath(member, parent_1);\n                        member.normalizedPath = generateNormalizedPath(member, parent_1);\n                        var intruderIndex = parent_1.children.findIndex(function (c) { return c.hierarchy !== parent_1.hierarchy; });\n                        if (intruderIndex !== -1) {\n                            parent_1.children.splice(intruderIndex, 0, member);\n                        }\n                        else {\n                            parent_1.children.push(member);\n                        }\n                    }\n                    member.parentName += member.name;\n                    key += member.parentName;\n                    if (!map[key]) {\n                        map[key] = member;\n                    }\n                };\n                for (var memberIndex = 0; memberIndex < tuple.members.length; memberIndex++) {\n                    _loop_1(memberIndex);\n                }\n            }\n            return copy(withTotal(root));\n        };\n        /**\n         * @hidden\n         */\n        var toData = function (data, columns, rows, breadth, depth) {\n            var result = Array.from(new Array(depth), function () { return ({ cells: Array.from(new Array(breadth), function () { return null; }) }); });\n            var hash = function (names) { return names.join('|'); };\n            var membersNames = function (tuple) { return tuple.members.map(function (m) { return m.name; }); };\n            var columnsIndexes = new Map();\n            var rowsIndexes = new Map();\n            columns.forEach(function (colMembers, idx) { columnsIndexes.set(hash(colMembers.path), idx); });\n            rows.forEach(function (rowMembers, idx) { rowsIndexes.set(hash(rowMembers.path), idx); });\n            data.forEach(function (item) {\n                var colIndex = columnsIndexes.get(hash(membersNames(item.columnTuple)));\n                var rowIndex = rowsIndexes.get(hash(membersNames(item.rowTuple)));\n                if (colIndex !== undefined && rowIndex !== undefined) {\n                    if (!result[rowIndex].cells[colIndex]) {\n                        result[rowIndex].row = rows[rowIndex].path;\n                        result[rowIndex].cells[colIndex] = item;\n                    }\n                }\n            });\n            return result;\n        };\n        var rotateMatrix = function (matrix, leafs, depth, breadth) {\n            var result = new Array(breadth);\n            for (var colIndex = 0; colIndex < breadth; colIndex++) {\n                for (var rowIndex = 0; rowIndex < depth; rowIndex++) {\n                    if (matrix[rowIndex] && matrix[rowIndex].cells[colIndex]) {\n                        var cell = matrix[rowIndex].cells[colIndex];\n                        if (!result[colIndex]) {\n                            result[colIndex] = {\n                                cells: new Array(depth).fill(null)\n                            };\n                        }\n                        result[colIndex].cells[rowIndex] = __assign(__assign({}, cell), { rowSpan: cell.colSpan, colSpan: cell.rowSpan });\n                    }\n                }\n            }\n            return [result, leafs, breadth, depth];\n        };\n        /**\n         * @hidden\n         */\n        var toColumns = function (root) {\n            var _a = toMatrix(root), matrix = _a[0], leafs = _a[1], depth = _a[2], breadth = _a[3];\n            for (var colIndex = 0; colIndex < breadth; colIndex++) {\n                var cell = null;\n                for (var rowIndex = 0; rowIndex < depth; rowIndex++) {\n                    if (matrix[rowIndex]) {\n                        var next = matrix[rowIndex].cells[colIndex];\n                        if (!next && cell) {\n                            cell.rowSpan = (cell.rowSpan || 1) + 1;\n                        }\n                        if (cell) {\n                            cell.colSpan = cell.breadth || 1;\n                        }\n                        if (next) {\n                            cell = next;\n                        }\n                    }\n                }\n            }\n            return [matrix, leafs, depth, breadth];\n        };\n        /**\n         * @hidden\n         */\n        var toRows = function (root) {\n            var _a = toMatrix(root), matrix = _a[0], leafs = _a[1], depth = _a[2], breadth = _a[3];\n            for (var colIndex = 0; colIndex < breadth; colIndex++) {\n                var cell = null;\n                for (var rowIndex = 0; rowIndex < depth; rowIndex++) {\n                    if (matrix[rowIndex]) {\n                        var next = matrix[rowIndex].cells[colIndex];\n                        if (!next && cell) {\n                            cell.rowSpan = (cell.rowSpan || 1) + 1;\n                        }\n                        if (cell) {\n                            cell.colSpan = cell.breadth;\n                        }\n                        if (next) {\n                            cell = next;\n                        }\n                    }\n                }\n            }\n            return rotateMatrix(matrix, leafs, depth, breadth);\n        };\n        /**\n         * @hidden\n         */\n        function copy(obj) {\n            return JSON.parse(JSON.stringify(obj));\n        }\n        var kpiMeasure = function (name, measure, type) {\n            return {\n                hierarchyUniqueName: name,\n                uniqueName: measure,\n                caption: measure,\n                measure: measure,\n                name: measure,\n                type: type,\n                kpi: true\n            };\n        };\n        /**\n         * @hidden\n         */\n        function buildKPIMeasures(node) {\n            var name = node.name;\n            return [\n                kpiMeasure(name, node.value, \"value\"),\n                kpiMeasure(name, node.goal, \"goal\"),\n                kpiMeasure(name, node.status, \"status\"),\n                kpiMeasure(name, node.trend, \"trend\")\n            ];\n        }\n        /**\n         * @hidden\n         */\n        var addKPI = function (data) {\n            var found;\n            var idx = 0;\n            for (; idx < data.length; idx++) {\n                if (data[idx].type === 2) {\n                    found = true;\n                    break;\n                }\n            }\n            if (found) {\n                data.splice(idx + 1, 0, {\n                    caption: \"KPIs\",\n                    defaultHierarchy: \"[KPIs]\",\n                    name: \"KPIs\",\n                    uniqueName: \"[KPIs]\"\n                });\n            }\n        };\n        /**\n         * @hidden\n         */\n        var compareAxisWithField = function (a, b) { return String(a.name) === String([(b.defaultHierarchy\n                ? b.defaultHierarchy\n                : b.uniqueName)]); };\n        /**\n         * @hidden\n         */\n        var compareAxes = function (a, b) { return String(a.name) === String(b.name); };\n        /**\n         * @hidden\n         */\n        var filterField = function (axes, out) {\n            var _loop_2 = function (i) {\n                var axis = axes[i];\n                var index = axis.name.findIndex(function (name) { return compareAxisWithField({ name: [name] }, out) || String(name).startsWith(out.uniqueName); });\n                if (index !== -1) {\n                    if (index === axis.name.length - 1 || axis.name.length === 1) {\n                        axes.splice(i, 1);\n                    }\n                    else {\n                        axis.name.splice(index, 1);\n                        var duplicatedAxisIndex = axes.findIndex(function (ax) { return ax !== axis && String(ax.name) === String(axis.name); });\n                        if (duplicatedAxisIndex !== -1) {\n                            axes[duplicatedAxisIndex] = __assign(__assign(__assign({}, axes[duplicatedAxisIndex]), axis), ((axes[duplicatedAxisIndex].expand || axis.expand) ? { expand: true } : {}));\n                            axes.splice(i, 1);\n                        }\n                    }\n                }\n            };\n            for (var i = axes.length - 1; i >= 0; i--) {\n                _loop_2(i);\n            }\n        };\n        /**\n         * @hidden\n         */\n        var insertAxis = function (axes, toInsert, state) {\n            var index = -1;\n            if (state.dropTarget && state.dropDirection) {\n                var offset = state.dropDirection\n                    ? (state.dropDirection === 'before'\n                        ? 0\n                        : 1)\n                    : 0;\n                index = axes.findIndex(function (c) { return compareAxes(c, state.dropTarget); }) + offset;\n            }\n            if (index !== -1) {\n                axes.forEach(function (axis) {\n                    var _a;\n                    if (axis.expand && axis.name.length > 1 && axis.name.length > index) {\n                        (_a = axis.name).splice.apply(_a, __spreadArray([index, 0], toInsert.name, false));\n                    }\n                });\n                axes.splice(index, 0, toInsert);\n            }\n            else {\n                axes.push(toInsert);\n            }\n        };\n        /**\n         * @hidden\n         */\n        var reverseColumnsByMeasures = function (columns) {\n            var firstColumn = columns.length && columns[0];\n            var lastMember = firstColumn && firstColumn.members[firstColumn.members.length - 1];\n            if (lastMember && isMeasure(lastMember)) {\n                var columnsArr = [];\n                var measuresCount = new Set(columns.map(function (col) { return col.members[col.members.length - 1].caption; })).size;\n                for (var i = 0; i < columns.length; i += measuresCount) {\n                    columnsArr.push(columns.slice(i, i + measuresCount));\n                }\n                var result_1 = [];\n                columnsArr.forEach(function (arr) {\n                    result_1.push.apply(result_1, arr.reverse());\n                });\n                return result_1;\n            }\n            return columns;\n        };\n\n        /**\n         * Creates the state object. See `fetchData`.\n         *\n         * @param response - ResponseData\n         * @returns DataState\n         */\n        /**\n         * @hidden\n         */\n        var createDataState = function (response) {\n            var state = {\n                columns: reverseColumnsByMeasures(response.columns.tuples),\n                data: response.data,\n                rows: response.rows.tuples\n            };\n            return state;\n        };\n\n        /**\n         * Creates a collection of AxisDescriptor base on the expandTree.\n         * @param expandTree - { [key: string]: boolean }\n         * @returns AxisDescriptor[]\n         *\n         * @example\n         * See `setRowExpand` or `setColumnExpand` functions.\n         */\n        /**\n         * @hidden\n         */\n        function createAxisDescriptors(expandTree) {\n            var descriptors = [];\n            for (var _i = 0, _a = Object.keys(expandTree); _i < _a.length; _i++) {\n                var key = _a[_i];\n                descriptors.push({ name: JSON.parse(key), expand: expandTree[key] });\n            }\n            return descriptors;\n        }\n\n        /**\n         * Sets sort descriptors to request options.\n         *\n         * @param options - RequestOptions\n         * @param sort - SortDescriptor[]\n         *\n         * @example\n         * const options: RequestOptions = { ... };\n         * const sort: SortDescriptor[] = [{ ... }, { ... }];\n         * setSort(options, sort);\n         * // skip the sort parameter to clear current filter - setSort(options);\n         *\n         * fetchData(options).then(createDataState).then((dataState: DataState) => {\n         *  // Update the UI\n         * });\n         */\n        /**\n         * @hidden\n         */\n        var setSort = function (options, sort) {\n            if (sort === void 0) { sort = []; }\n            options.sort = sort;\n        };\n\n        /**\n         * Sets filter descriptors to request options.\n         *\n         * @param options - RequestOptions\n         * @param filter - FilterDescriptor[]\n         *\n         * @example\n         * const options: RequestOptions = { ... };\n         * const filter: FilterDescriptor[] = [{ ... }, { ... }];\n         * setFilter(options, filter);\n         * // skip the filter parameter to clear current filter - setFilter(options);\n         *\n         * fetchData(options).then(createDataState).then((dataState: DataState) => {\n         *  // Update the UI\n         * });\n         */\n        /**\n         * @hidden\n         */\n        var setFilter = function (options, filter) {\n            if (filter === void 0) { filter = []; }\n            options.filter = filter;\n        };\n\n        /**\n         * @hidden\n         */\n        exports.HEADERS_ACTION = void 0;\n        (function (HEADERS_ACTION) {\n            HEADERS_ACTION[\"toggle\"] = \"HEADERS_ACTION_TOGGLE\";\n            HEADERS_ACTION[\"expand\"] = \"HEADERS_ACTION_EXPAND\";\n            HEADERS_ACTION[\"collapse\"] = \"HEADERS_ACTION_COLLAPSE\";\n        })(exports.HEADERS_ACTION || (exports.HEADERS_ACTION = {}));\n        var findPath = function (node, matchFn, matched) {\n            var result = new Set();\n            node.children.forEach(function (child) {\n                var match = matchFn(child);\n                if (matched) {\n                    result.add(String(child.path));\n                }\n                findPath(child, matchFn, (matched || match)).map(function (h) {\n                    result.add(h);\n                });\n            });\n            return Array.from(result.values());\n        };\n        /**\n         * @hidden\n         */\n        var headersReducer = function (state, action) {\n            switch (action.type) {\n                case exports.HEADERS_ACTION.toggle: {\n                    var existing = state.find((function (s) { return String(s.name) === String(action.payload); }));\n                    return headersReducer(state, __assign(__assign({}, action), { type: existing && (existing.expand)\n                            ? exports.HEADERS_ACTION.collapse\n                            : exports.HEADERS_ACTION.expand }));\n                }\n                case exports.HEADERS_ACTION.expand: {\n                    var existing_1 = state.find((function (s) { return String(s.name) === String(action.payload); }));\n                    if (existing_1 && existing_1.expand === true) {\n                        return state;\n                    }\n                    else if (existing_1 && (existing_1.expand === false || existing_1.expand === undefined)) {\n                        return state.map(function (s) { return s === existing_1 ? (__assign(__assign({}, existing_1), { expand: true })) : s; });\n                    }\n                    else {\n                        var nextState = state.slice();\n                        nextState.push({ name: action.payload, expand: true });\n                        return nextState;\n                    }\n                }\n                case exports.HEADERS_ACTION.collapse: {\n                    var filtered_1 = findPath(action.tree, function (node) { return !node.total && String(node.path) === String(action.payload); });\n                    var newState = state.slice()\n                        .filter(function (h) { return !filtered_1.some(function (f) { return f === String(h.name); }); })\n                        .map(function (h) { return (__assign(__assign({}, h), { expand: Boolean(h.expand) })); })\n                        .map(function (h) { return (String(h.name) === String(action.payload))\n                        ? action.payload.length > 1 ? undefined : { name: action.payload, expand: false }\n                        : h; })\n                        .filter(Boolean);\n                    return newState;\n                }\n                default: {\n                    return state;\n                }\n            }\n        };\n\n        /**\n         * @hidden\n         */\n        exports.PIVOT_CONFIGURATOR_ACTION = void 0;\n        (function (PIVOT_CONFIGURATOR_ACTION) {\n            // Selection\n            PIVOT_CONFIGURATOR_ACTION[\"toggleSelection\"] = \"PIVOT_CONFIGURATOR_ACTION_TOGGLE_SELECTION\";\n            PIVOT_CONFIGURATOR_ACTION[\"addColumnAxis\"] = \"PIVOT_CONFIGURATOR_ACTION_ADD_COLUMN_AXIS\";\n            PIVOT_CONFIGURATOR_ACTION[\"addColumnAxes\"] = \"PIVOT_CONFIGURATOR_ACTION_ADD_COLUMN_AXES\";\n            PIVOT_CONFIGURATOR_ACTION[\"removeColumnAxis\"] = \"PIVOT_CONFIGURATOR_ACTION_REMOVE_COLUMN_AXIS\";\n            PIVOT_CONFIGURATOR_ACTION[\"removeColumnAxes\"] = \"PIVOT_CONFIGURATOR_ACTION_REMOVE_COLUMN_AXES\";\n            PIVOT_CONFIGURATOR_ACTION[\"addRowAxis\"] = \"PIVOT_CONFIGURATOR_ACTION_ADD_ROW_AXIS\";\n            PIVOT_CONFIGURATOR_ACTION[\"addRowAxes\"] = \"PIVOT_CONFIGURATOR_ACTION_ADD_ROW_AXES\";\n            PIVOT_CONFIGURATOR_ACTION[\"removeRowAxis\"] = \"PIVOT_CONFIGURATOR_ACTION_REMOVE_ROW_AXIS\";\n            PIVOT_CONFIGURATOR_ACTION[\"removeRowAxes\"] = \"PIVOT_CONFIGURATOR_ACTION_REMOVE_ROW_AXES\";\n            PIVOT_CONFIGURATOR_ACTION[\"addMeasureAxis\"] = \"PIVOT_CONFIGURATOR_ACTION_ADD_MEASURE_AXIS\";\n            PIVOT_CONFIGURATOR_ACTION[\"addMeasureAxes\"] = \"PIVOT_CONFIGURATOR_ACTION_ADD_MEASURE_AXES\";\n            PIVOT_CONFIGURATOR_ACTION[\"removeMeasureAxis\"] = \"PIVOT_CONFIGURATOR_ACTION_REMOVE_MEASURE_AXIS\";\n            PIVOT_CONFIGURATOR_ACTION[\"removeMeasureAxes\"] = \"PIVOT_CONFIGURATOR_ACTION_REMOVE_MEASURE_AXES\";\n            // Removal\n            PIVOT_CONFIGURATOR_ACTION[\"remove\"] = \"PIVOT_CONFIGURATOR_ACTION_REMOVE\";\n            // Sort\n            PIVOT_CONFIGURATOR_ACTION[\"setSort\"] = \"PIVOT_CONFIGURATOR_ACTION_SET_SORT\";\n            // Filter\n            PIVOT_CONFIGURATOR_ACTION[\"setFilter\"] = \"PIVOT_CONFIGURATOR_ACTION_SET_FILTER\";\n            PIVOT_CONFIGURATOR_ACTION[\"addFilter\"] = \"PIVOT_CONFIGURATOR_ACTION_ADD_FILTER\";\n            PIVOT_CONFIGURATOR_ACTION[\"changeFilter\"] = \"PIVOT_CONFIGURATOR_ACTION_CHANGE_FILTER\";\n            PIVOT_CONFIGURATOR_ACTION[\"removeFilter\"] = \"PIVOT_CONFIGURATOR_ACTION_REMOVE_FILTER\";\n            // Drag\n            PIVOT_CONFIGURATOR_ACTION[\"setDragItem\"] = \"PIVOT_CONFIGURATOR_ACTION_SET_DRAGITEM\";\n            PIVOT_CONFIGURATOR_ACTION[\"drop\"] = \"PIVOT_CONFIGURATOR_ACTION_DROP\";\n            PIVOT_CONFIGURATOR_ACTION[\"setDropZone\"] = \"PIVOT_CONFIGURATOR_ACTION_SET_DROP_ZONE\";\n            PIVOT_CONFIGURATOR_ACTION[\"setDropTarget\"] = \"PIVOT_CONFIGURATOR_ACTION_SET_DROP_TARGET\";\n            PIVOT_CONFIGURATOR_ACTION[\"setDropDirection\"] = \"PIVOT_CONFIGURATOR_ACTION_SET_DROP_DIRECTION\";\n        })(exports.PIVOT_CONFIGURATOR_ACTION || (exports.PIVOT_CONFIGURATOR_ACTION = {}));\n        /**\n         * @hidden\n         */\n        var configuratorReducer = function (state, action) {\n            var newRows;\n            var newColumns;\n            var newMeasures;\n            var newSort;\n            var newFilter;\n            var newDragitem;\n            var newDropZone;\n            var newDropDirection;\n            var newDropTarget;\n            switch (action.type) {\n                case exports.PIVOT_CONFIGURATOR_ACTION.toggleSelection: {\n                    if (Array.isArray(action.payload)) ;\n                    else {\n                        var payload_1 = action.payload;\n                        if (payload_1.type === 2 || 'aggregator' in payload_1) {\n                            if (state.measureAxes.some(function (s) { return compareAxisWithField(s, payload_1); })) {\n                                return configuratorReducer(state, __assign(__assign({}, action), { type: exports.PIVOT_CONFIGURATOR_ACTION.removeMeasureAxis }));\n                            }\n                            else {\n                                return configuratorReducer(state, __assign(__assign({}, action), { type: exports.PIVOT_CONFIGURATOR_ACTION.addMeasureAxis }));\n                            }\n                        }\n                        else if (payload_1.type === 'kpi') {\n                            var measures = buildKPIMeasures(payload_1);\n                            if (measures.every(function (m) { return state.measureAxes.some(function (s) { return compareAxisWithField(s, m); }); })) {\n                                return configuratorReducer(state, __assign(__assign({}, action), { type: exports.PIVOT_CONFIGURATOR_ACTION.removeMeasureAxes, payload: measures }));\n                            }\n                            else {\n                                return configuratorReducer(state, __assign(__assign({}, action), { type: exports.PIVOT_CONFIGURATOR_ACTION.addMeasureAxes, payload: measures.filter(function (m) { return !state.measureAxes.some(function (s) { return compareAxisWithField(s, m); }); }) }));\n                            }\n                        }\n                        else if (action.payload.kpi) {\n                            if (state.measureAxes.some(function (s) { return compareAxisWithField(s, payload_1); })) {\n                                return configuratorReducer(state, __assign(__assign({}, action), { type: exports.PIVOT_CONFIGURATOR_ACTION.removeMeasureAxis }));\n                            }\n                            else {\n                                return configuratorReducer(state, __assign(__assign({}, action), { type: exports.PIVOT_CONFIGURATOR_ACTION.addMeasureAxis }));\n                            }\n                        }\n                        else {\n                            if (state.columnAxes.some(function (s) { return compareAxisWithField(s, payload_1); })) {\n                                return configuratorReducer(state, __assign(__assign({}, action), { type: exports.PIVOT_CONFIGURATOR_ACTION.removeColumnAxis }));\n                            }\n                            else if (state.rowAxes.some(function (s) { return compareAxisWithField(s, payload_1); })) {\n                                return configuratorReducer(state, __assign(__assign({}, action), { type: exports.PIVOT_CONFIGURATOR_ACTION.removeRowAxis }));\n                            }\n                            else if ((state.columnAxes && state.columnAxes.length) && (!state.rowAxes || !state.rowAxes.length)) {\n                                return configuratorReducer(state, __assign(__assign({}, action), { type: exports.PIVOT_CONFIGURATOR_ACTION.addRowAxis }));\n                            }\n                            else {\n                                return configuratorReducer(state, __assign(__assign({}, action), { type: exports.PIVOT_CONFIGURATOR_ACTION.addColumnAxis }));\n                            }\n                        }\n                    }\n                    break;\n                }\n                case exports.PIVOT_CONFIGURATOR_ACTION.addColumnAxis: {\n                    newColumns = __spreadArray(__spreadArray([], (state.columnAxes || []), true), [\n                        { name: [action.payload.defaultHierarchy || action.payload.uniqueName] }\n                    ], false);\n                    break;\n                }\n                case exports.PIVOT_CONFIGURATOR_ACTION.addColumnAxes: {\n                    // TODO;\n                    break;\n                }\n                case exports.PIVOT_CONFIGURATOR_ACTION.removeColumnAxis: {\n                    newColumns = __spreadArray([], (state.columnAxes || []).filter(function (s) { return !compareAxisWithField(s, action.payload); }), true);\n                    filterField(newColumns, action.payload);\n                    break;\n                }\n                case exports.PIVOT_CONFIGURATOR_ACTION.removeColumnAxes: {\n                    // TODO;\n                    break;\n                }\n                case exports.PIVOT_CONFIGURATOR_ACTION.addRowAxis: {\n                    newRows = __spreadArray(__spreadArray([], (state.rowAxes || []), true), [\n                        { name: [action.payload.defaultHierarchy || action.payload.uniqueName] }\n                    ], false);\n                    break;\n                }\n                case exports.PIVOT_CONFIGURATOR_ACTION.addRowAxes: {\n                    // TODO;\n                    break;\n                }\n                case exports.PIVOT_CONFIGURATOR_ACTION.removeRowAxis: {\n                    newRows = __spreadArray([], (state.rowAxes || []).filter(function (s) { return !compareAxisWithField(s, action.payload); }), true);\n                    filterField(newRows, action.payload);\n                    break;\n                }\n                case exports.PIVOT_CONFIGURATOR_ACTION.removeRowAxes: {\n                    // TODO;\n                    break;\n                }\n                case exports.PIVOT_CONFIGURATOR_ACTION.addMeasureAxis: {\n                    newMeasures = __spreadArray(__spreadArray([], (state.measureAxes || []), true), [\n                        { name: [action.payload.defaultHierarchy || action.payload.uniqueName] }\n                    ], false);\n                    break;\n                }\n                case exports.PIVOT_CONFIGURATOR_ACTION.removeMeasureAxis: {\n                    newMeasures = __spreadArray([], (state.measureAxes || []).filter(function (s) { return !compareAxisWithField(s, action.payload); }), true);\n                    break;\n                }\n                case exports.PIVOT_CONFIGURATOR_ACTION.addMeasureAxes: {\n                    newMeasures = __spreadArray(__spreadArray([], (state.measureAxes || []), true), (action.payload || []).map(function (p) { return ({ name: [p.defaultHierarchy || p.uniqueName] }); }), true);\n                    break;\n                }\n                case exports.PIVOT_CONFIGURATOR_ACTION.removeMeasureAxes: {\n                    newMeasures = __spreadArray([], (state.measureAxes || []).filter(function (s) { return !action.payload.some(function (p) { return compareAxisWithField(s, p); }); }), true);\n                    break;\n                }\n                case exports.PIVOT_CONFIGURATOR_ACTION.remove: {\n                    if (state.columnAxes.some(function (s) { return compareAxes(s, action.payload); })) {\n                        newColumns = __spreadArray([], state.columnAxes.filter(function (s) { return !compareAxes(s, action.payload); }), true);\n                        filterField(newColumns, { uniqueName: action.payload.name });\n                    }\n                    if (state.rowAxes.some(function (s) { return compareAxes(s, action.payload); })) {\n                        newRows = __spreadArray([], state.rowAxes.filter(function (s) { return !compareAxes(s, action.payload); }), true);\n                        filterField(newRows, { uniqueName: action.payload.name });\n                    }\n                    if (state.measureAxes.some(function (s) { return compareAxes(s, action.payload); })) {\n                        newMeasures = __spreadArray([], state.measureAxes.filter(function (s) { return !compareAxes(s, action.payload); }), true);\n                    }\n                    break;\n                }\n                case exports.PIVOT_CONFIGURATOR_ACTION.setDragItem:\n                    newDragitem = action.payload;\n                    break;\n                case exports.PIVOT_CONFIGURATOR_ACTION.setDropZone:\n                    newDropZone = action.payload;\n                    break;\n                case exports.PIVOT_CONFIGURATOR_ACTION.setDropTarget:\n                    newDropTarget = action.payload;\n                    break;\n                case exports.PIVOT_CONFIGURATOR_ACTION.setDropDirection:\n                    newDropDirection = action.payload;\n                    break;\n                case exports.PIVOT_CONFIGURATOR_ACTION.drop:\n                    if (state.dragItem && state.dropZone) {\n                        var currentColumn = state.columnAxes.find(function (s) { return compareAxes(s, action.payload); });\n                        var currentRow = state.rowAxes.find(function (s) { return compareAxes(s, action.payload); });\n                        var currentMeasure = state.measureAxes.find(function (s) { return compareAxes(s, action.payload); });\n                        var current = void 0;\n                        if (currentColumn) {\n                            current = currentColumn;\n                            newColumns = __spreadArray([], state.columnAxes.filter(function (s) { return !compareAxes(s, action.payload); }), true);\n                            filterField(newColumns, { uniqueName: action.payload.name });\n                        }\n                        if (currentRow) {\n                            current = currentRow;\n                            newRows = __spreadArray([], state.rowAxes.filter(function (s) { return !compareAxes(s, action.payload); }), true);\n                            filterField(newRows, { uniqueName: action.payload.name });\n                        }\n                        if (currentMeasure) {\n                            current = currentMeasure;\n                            newMeasures = __spreadArray([], state.measureAxes.filter(function (s) { return !compareAxes(s, action.payload); }), true);\n                        }\n                        switch (state.dropZone) {\n                            case 'columnAxes': {\n                                newColumns = newColumns || state.columnAxes.slice();\n                                insertAxis(newColumns, current, state);\n                                break;\n                            }\n                            case 'rowAxes': {\n                                newRows = newRows || state.rowAxes.slice();\n                                insertAxis(newRows, current, state);\n                                break;\n                            }\n                            case 'measureAxes': {\n                                newMeasures = newMeasures || state.measureAxes.slice();\n                                insertAxis(newMeasures, current, state);\n                                break;\n                            }\n                        }\n                    }\n                    newDragitem = null;\n                    newDropZone = null;\n                    newDropTarget = null;\n                    break;\n                case exports.PIVOT_CONFIGURATOR_ACTION.setSort:\n                    newSort = action.payload;\n                    break;\n                case exports.PIVOT_CONFIGURATOR_ACTION.setFilter:\n                    if (Array.isArray(action.payload)) {\n                        newFilter = action.payload;\n                    }\n                    else {\n                        newFilter = [action.payload];\n                    }\n                    break;\n                case exports.PIVOT_CONFIGURATOR_ACTION.addFilter:\n                    newFilter = (state.filter || []).slice();\n                    if (Array.isArray(action.payload)) {\n                        newFilter.push.apply(newFilter, action.payload);\n                    }\n                    else {\n                        newFilter.push(action.payload);\n                    }\n                    break;\n                case exports.PIVOT_CONFIGURATOR_ACTION.changeFilter:\n                    newFilter = (Array.isArray(action.payload)\n                        ? (state.filter || []).map(function (f) { return action.payload.some(function (a) { return a.field === f.field; })\n                            ? action.payload.find(function (a) { return a.field === f.field; })\n                            : f; })\n                        : (state.filter || []).map(function (f) { return f.field === action.payload.field\n                            ? action.payload\n                            : f; }));\n                    break;\n                case exports.PIVOT_CONFIGURATOR_ACTION.removeFilter:\n                    newFilter = (state.filter || []).slice();\n                    if (Array.isArray(action.payload)) {\n                        newFilter = newFilter.filter(function (f) { return !action.payload.some(function (p) { return p.field === f.field &&\n                            p.operator === f.operator; }); });\n                    }\n                    else {\n                        newFilter = newFilter.filter(function (f) { return !(f.field === action.payload.field\n                            && f.operator === action.payload.operator); });\n                    }\n                    break;\n            }\n            return {\n                dragItem: newDragitem,\n                dropTarget: newDropTarget,\n                dropDirection: newDropDirection,\n                dropZone: newDropZone,\n                columnAxes: newColumns,\n                rowAxes: newRows,\n                measureAxes: newMeasures,\n                filter: newFilter,\n                sort: newSort\n            };\n        };\n\n        // tslint:disable:object-literal-sort-keys\n        /**\n         * Represents the aggregate object which calculates the total value. Applicable for local data binding.\n         */\n        var sumAggregate = {\n            init: function (data) {\n                if (('sum' in data) === false) {\n                    data.sum = 0;\n                }\n            },\n            merge: function (src, dest) {\n                dest.sum += src.sum;\n            },\n            accumulate: function (acc, value) {\n                acc.sum += value;\n            },\n            result: function (data) { return data.sum; },\n            format: function (value) { return value.toFixed(2); }\n        };\n        /**\n         * Represents the aggregate object which calculates the count value. Applicable for local data binding.\n         */\n        var countAggregate = {\n            init: function (data) {\n                if (('countA' in data) === false) {\n                    data.countA = 0;\n                }\n            },\n            merge: function (src, dest) {\n                dest.countA += src.countA;\n            },\n            accumulate: function (acc, _value) {\n                acc.countA += 1;\n            },\n            result: function (data) { return data.countA; },\n            format: function (value) { return value.toFixed(); }\n        };\n        /**\n         * Represents the aggregate object which calculates the minimum value. Applicable for local data binding.\n         */\n        var minAggregate = {\n            init: function (data) {\n                if (('min' in data) === false) {\n                    data.min = Number.POSITIVE_INFINITY;\n                }\n            },\n            merge: function (src, dest) {\n                dest.min = Math.min(src.min, dest.min);\n            },\n            accumulate: function (acc, value) {\n                acc.min = Math.min(value, acc.min);\n            },\n            result: function (data) { return Number.isFinite(data.min) ? data.min : NaN; },\n            format: function (value) { return value.toFixed(2); }\n        };\n        /**\n         * Represents the aggregate object which calculates the maximum value. Applicable for local data binding.\n         */\n        var maxAggregate = {\n            init: function (data) {\n                if (('max' in data) === false) {\n                    data.max = Number.NEGATIVE_INFINITY;\n                }\n            },\n            merge: function (src, dest) {\n                dest.max = Math.max(src.max, dest.max);\n            },\n            accumulate: function (acc, value) {\n                acc.max = Math.max(value, acc.max);\n            },\n            result: function (data) { return Number.isFinite(data.max) ? data.max : NaN; },\n            format: function (value) { return value.toFixed(2); }\n        };\n        /**\n         * Represents the aggregate object which calculates the average value. Applicable for local data binding.\n         */\n        var averageAggregate = {\n            init: function (data) {\n                if (('count' in data) === false) {\n                    data.sumA = 0;\n                    data.count = 0;\n                }\n            },\n            merge: function (src, dest) {\n                dest.sumA += src.sumA;\n                dest.count += src.count;\n            },\n            accumulate: function (acc, value) {\n                acc.sumA += value;\n                acc.count += 1;\n            },\n            result: function (data) { return data.sumA / data.count; },\n            format: function (value) { return value.toFixed(2); }\n        };\n\n        /**\n         * @hidden\n         */\n        var isPresent = function (value) { return value !== null && value !== undefined; };\n        /**\n         * @hidden\n         */\n        var isBlank = function (value) { return value === null || value === undefined; };\n        /**\n         * @hidden\n         */\n        var isArray = function (value) { return Array.isArray(value); };\n        /**\n         * @hidden\n         */\n        var isFunction = function (value) { return typeof value === 'function'; };\n        /**\n         * @hidden\n         */\n        var isString = function (value) { return typeof value === 'string'; };\n        /**\n         * @hidden\n         */\n        var isNullOrEmptyString = function (value) { return isBlank(value) || value.trim().length === 0; };\n        /**\n         * @hidden\n         */\n        var isNotNullOrEmptyString = function (value) { return !isNullOrEmptyString(value); };\n        /**\n         * @hidden\n         */\n        var isNumeric = function (value) { return !isNaN(value - parseFloat(value)); };\n        /**\n         * @hidden\n         */\n        var isDate = function (value) { return value && value.getTime; };\n\n        // tslint:enable:max-line-length\n        /**\n         * @hidden\n         * Type guard for `CompositeFilterDescriptor`.\n         */\n        var isCompositeFilterDescriptor = function (source) {\n            return isPresent(source.filters);\n        };\n\n        /**\n         * @hidden\n         */\n        var ifElse = function (predicate, right, left) { return function (value) { return predicate(value) ? right(value) : left(value); }; };\n        /**\n         * @hidden\n         * Performs the right-to-left function composition. Functions should have a unary.\n         */\n        var compose = function () {\n            var args = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                args[_i] = arguments[_i];\n            }\n            return function (data) { return args.reduceRight(function (acc, curr) { return curr(acc); }, data); };\n        };\n\n        /**\n         * @hidden\n         */\n        var toUTC = function (date) {\n            return new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate(), date.getHours(), date.getMinutes(), date.getSeconds(), date.getMilliseconds()));\n        };\n        /**\n         * @hidden\n         */\n        var isDateValue = function (x) { return isDate(x.value); };\n\n        var getterCache = {};\n        var FIELD_REGEX = /\\[(?:(\\d+)|['\"](.*?)['\"])\\]|((?:(?!\\[.*?\\]|\\.).)+)/g;\n        // tslint:disable-next-line:no-string-literal\n        getterCache['undefined'] = function (obj) { return obj; };\n        /**\n         * @hidden\n         */\n        var getter = function (field, safe) {\n            var key = field + safe;\n            if (getterCache[key]) {\n                return getterCache[key];\n            }\n            var fields = [];\n            field.replace(FIELD_REGEX, function (_, index, indexAccessor, field) {\n                fields.push(isPresent(index) ? index : (indexAccessor || field));\n                return undefined;\n            });\n            getterCache[key] = function (obj) {\n                var result = obj;\n                for (var idx = 0; idx < fields.length; idx++) {\n                    result = result[fields[idx]];\n                    if (!isPresent(result) && safe) {\n                        return result;\n                    }\n                }\n                return result;\n            };\n            return getterCache[key];\n        };\n\n        var pairwise = function (key) { return function (value) { return [key, value]; }; };\n        var empty = function () { return null; };\n        var isNotEmptyArray = function (value) { return isPresent(value) && isArray(value) && value.length > 0; };\n        var isNotEmpty = function (accessor) { return function (value) { return isNotEmptyArray(accessor(value)); }; };\n        var runOrEmpty = function (predicate, fn) { return ifElse(predicate, fn, empty); };\n        var calcPage = function (_a) {\n            var skip = _a.skip, take = _a.take;\n            return Math.floor((skip || 0) / take) + 1;\n        };\n        var formatDescriptors = function (accessor, formatter) { return function (state) { return (accessor(state).map(formatter).join(\"~\")); }; };\n        var removeAfter = function (what) { return function (str) { return str.slice(0, str.indexOf(what)); }; };\n        var replace = function (patterns) {\n            return compose.apply(void 0, patterns.map(function (_a) {\n                var left = _a[0], right = _a[1];\n                return function (s) { return s.replace(new RegExp(left, \"g\"), right); };\n            }));\n        };\n        var sanitizeDateLiterals = replace([[\"\\\"\", \"\"], [\":\", \"-\"]]);\n        var removeAfterDot = removeAfter(\".\");\n        var directionFormatter = function (_a) {\n            var field = _a.field, _b = _a.dir, dir = _b === void 0 ? \"asc\" : _b;\n            return field + \"-\" + dir;\n        };\n        var aggregateFormatter = function (_a) {\n            var field = _a.field, aggregate = _a.aggregate;\n            return field + \"-\" + aggregate;\n        };\n        var take = getter(\"take\");\n        var aggregates = getter(\"aggregates\");\n        getter(\"skip\");\n        var group = getter(\"group\");\n        var sort = getter(\"sort\", true);\n        var formatSort = formatDescriptors(sort, directionFormatter);\n        var formatGroup = formatDescriptors(group, directionFormatter);\n        var formatAggregates = formatDescriptors(aggregates, aggregateFormatter);\n        var prefixDateValue = function (value) { return \"datetime'\" + value + \"'\"; };\n        var formatDateValue = compose(prefixDateValue, removeAfterDot, sanitizeDateLiterals, JSON.stringify, toUTC);\n        var formatDate = function (_a) {\n            var field = _a.field, value = _a.value, ignoreCase = _a.ignoreCase, operator = _a.operator;\n            return ({\n                value: formatDateValue(value),\n                field: field,\n                ignoreCase: ignoreCase,\n                operator: operator\n            });\n        };\n        var normalizeSort = function (state) { return Object.assign({}, state, {\n            sort: (sort(state) || []).filter(function (_a) {\n                var dir = _a.dir;\n                return isNotNullOrEmptyString(dir);\n            })\n        }); };\n        compose(pairwise('page'), calcPage);\n        compose(pairwise('pageSize'), take);\n        compose(pairwise('group'), formatGroup);\n        var transformSort = compose(pairwise('sort'), formatSort);\n        compose(pairwise('aggregate'), formatAggregates);\n        compose(runOrEmpty(isNotEmpty(sort), transformSort), normalizeSort);\n        var filterFormatter = function (_a) {\n            var field = _a.field, operator = _a.operator, value = _a.value;\n            return field + \"~\" + operator + \"~\" + value;\n        };\n        ifElse(isDateValue, compose(filterFormatter, formatDate), filterFormatter);\n\n        // tslint:enable:max-line-length\n        var set = function (field, target, value) {\n            target[field] = value;\n            return target;\n        };\n        var convert = function (mapper) { return function (values) { return Object.keys(values).reduce(mapper.bind(null, values), {}); }; };\n        var translateAggregate = convert(function (source, acc, field) { return set(field.toLowerCase(), acc, source[field]); });\n        var translateAggregates = convert(function (source, acc, field) { return set(field, acc, translateAggregate(source[field])); });\n        var valueOrDefault = function (value, defaultValue) { return isPresent(value) ? value : defaultValue; };\n        var normalizeGroup = function (group) { return ({\n            aggregates: group.Aggregates || group.aggregates,\n            field: group.Member || group.member || group.field,\n            hasSubgroups: group.HasSubgroups || group.hasSubgroups || false,\n            items: group.Items || group.items,\n            value: valueOrDefault(group.Key, valueOrDefault(group.key, group.value))\n        }); };\n        var translateGroup = compose(function (_a) {\n            var field = _a.field, hasSubgroups = _a.hasSubgroups, value = _a.value, aggregates = _a.aggregates, items = _a.items;\n            return ({\n                aggregates: translateAggregates(aggregates),\n                field: field,\n                items: hasSubgroups ? items.map(translateGroup) : items,\n                value: value\n            });\n        }, normalizeGroup);\n\n        var logic = {\n            \"or\": {\n                concat: function (acc, fn) { return function (a) { return acc(a) || fn(a); }; },\n                identity: function () { return false; }\n            },\n            \"and\": {\n                concat: function (acc, fn) { return function (a) { return acc(a) && fn(a); }; },\n                identity: function () { return true; }\n            }\n        };\n        var operatorsMap = {\n            contains: function (a, b) { return (a || \"\").indexOf(b) >= 0; },\n            doesnotcontain: function (a, b) { return (a || \"\").indexOf(b) === -1; },\n            doesnotendwith: function (a, b) { return (a || \"\").indexOf(b, (a || \"\").length - (b || \"\").length) < 0; },\n            doesnotstartwith: function (a, b) { return (a || \"\").lastIndexOf(b, 0) === -1; },\n            endswith: function (a, b) { return (a || \"\").indexOf(b, (a || \"\").length - (b || \"\").length) >= 0; },\n            eq: function (a, b) { return a === b; },\n            gt: function (a, b) { return a > b; },\n            gte: function (a, b) { return a >= b; },\n            isempty: function (a) { return a === ''; },\n            isnotempty: function (a) { return a !== ''; },\n            isnotnull: function (a) { return isPresent(a); },\n            isnull: function (a) { return isBlank(a); },\n            lt: function (a, b) { return a < b; },\n            lte: function (a, b) { return a <= b; },\n            neq: function (a, b) { return a != b; },\n            startswith: function (a, b) { return (a || \"\").lastIndexOf(b, 0) === 0; }\n        };\n        var dateRegExp = /^\\/Date\\((.*?)\\)\\/$/;\n        var convertValue = function (value, ignoreCase) {\n            if (value != null && isString(value)) {\n                var date = dateRegExp.exec(value);\n                if (date) {\n                    return new Date(+date[1]).getTime();\n                }\n                else if (ignoreCase) {\n                    return value.toLowerCase();\n                }\n            }\n            else if (value != null && isDate(value)) {\n                return value.getTime();\n            }\n            return value;\n        };\n        var typedGetter = function (prop, value, ignoreCase) {\n            if (!isPresent(value)) {\n                return prop;\n            }\n            var acc = prop;\n            if (isString(value)) {\n                var date = dateRegExp.exec(value);\n                if (date) {\n                    value = new Date(+date[1]);\n                }\n                else {\n                    acc = function (a) {\n                        var x = prop(a);\n                        if (typeof x === 'string' && ignoreCase) {\n                            return x.toLowerCase();\n                        }\n                        else {\n                            return isNumeric(x) ? x + \"\" : x;\n                        }\n                    };\n                }\n            }\n            if (isDate(value)) {\n                return function (a) {\n                    var x = acc(a);\n                    return isDate(x) ? x.getTime() : x;\n                };\n            }\n            return acc;\n        };\n        var transformFilter = function (_a) {\n            var field = _a.field, ignoreCase = _a.ignoreCase, value = _a.value, operator = _a.operator;\n            field = !isPresent(field) ? function (a) { return a; } : field;\n            ignoreCase = isPresent(ignoreCase) ? ignoreCase : true;\n            var itemProp = typedGetter(isFunction(field) ? field : getter(field, true), value, ignoreCase);\n            value = convertValue(value, ignoreCase);\n            var op = isFunction(operator) ? operator : operatorsMap[operator];\n            return function (a) { return op(itemProp(a), value, ignoreCase); };\n        };\n        /**\n         * @hidden\n         */\n        var transformCompositeFilter = function (filter) {\n            var combiner = logic[filter.logic];\n            return filter.filters\n                .filter(isPresent)\n                .map(function (x) { return isCompositeFilterDescriptor(x) ? transformCompositeFilter(x) : transformFilter(x); })\n                .reduce(combiner.concat, combiner.identity);\n        };\n\n        // tslint:disable:max-line-length\n        /**\n         * Creates a [Predicate]({% slug api_kendo-data-query_predicate %}) function for the specified [CompositeFilterDescriptor]({% slug api_kendo-data-query_compositefilterdescriptor %}).\n         *\n         * @param {CompositeFilterDescriptor} descriptor - The descriptor for which the predicate is created.\n         * @returns {Predicate} - The created function instance.\n         *\n         * @example\n         * ```ts\n         * import { compileFilter } from '@progress/kendo-data-query';\n         *\n         * const data = [{ name: \"Pork\" }, { name: \"Pepper\" }, { name: \"Beef\" } ];\n         * const predicate = compileFilter({ logic: \"and\", filters: [{ field: \"name\", operator: \"startswith\", value: \"P\" }] });\n         * const result = data.filter(predicate);\n         *\n         * ```\n         */\n        // tslint:enable:max-line-length\n        var compileFilter = function (descriptor) {\n            if (!descriptor || descriptor.filters.length === 0) {\n                return function () { return true; };\n            }\n            return transformCompositeFilter(descriptor);\n        };\n\n        /**\n         * Represents the list of supported [`FilterDescriptor`]({% slug api_kendo-data-query_filterdescriptor %}) operators.\n         * Allows restricting `FilterDescriptor.operator` definition to available values only.\n         */\n        var FilterOperator;\n        (function (FilterOperator) {\n            /**\n             * The `contains` operator.\n             */\n            FilterOperator[\"Contains\"] = \"contains\";\n            /**\n             * The `doesnotcontain` operator.\n             */\n            FilterOperator[\"DoesNotContain\"] = \"doesnotcontain\";\n            /**\n             * The `doesnotendwith` operator.\n             */\n            FilterOperator[\"DoesNotEndWith\"] = \"doesnotendwith\";\n            /**\n             * The `doesnotstartwith` operator.\n             */\n            FilterOperator[\"DoesNotStartWith\"] = \"doesnotstartwith\";\n            /**\n             * The `endswith` operator.\n             */\n            FilterOperator[\"EndsWith\"] = \"endswith\";\n            /**\n             * The `eq` operator.\n             */\n            FilterOperator[\"EqualTo\"] = \"eq\";\n            /**\n             * The `gt` operator.\n             */\n            FilterOperator[\"GreaterThan\"] = \"gt\";\n            /**\n             * The `gte` operator.\n             */\n            FilterOperator[\"GreaterThanOrEqual\"] = \"gte\";\n            /**\n             * The `isempty` operator.\n             */\n            FilterOperator[\"IsEmpty\"] = \"isempty\";\n            /**\n             * The `isnotempty` operator.\n             */\n            FilterOperator[\"IsNotEmpty\"] = \"isnotempty\";\n            /**\n             * The `isnotnull` operator.\n             */\n            FilterOperator[\"IsNotNull\"] = \"isnotnull\";\n            /**\n             * The `isnull` operator.\n             */\n            FilterOperator[\"IsNull\"] = \"isnull\";\n            /**\n             * The `lt` operator.\n             */\n            FilterOperator[\"LessThan\"] = \"lt\";\n            /**\n             * The `lte` operator.\n             */\n            FilterOperator[\"LessThanOrEqual\"] = \"lte\";\n            /**\n             * The `neq` operator.\n             */\n            FilterOperator[\"NotEqualTo\"] = \"neq\";\n            /**\n             * The `startswith` operator.\n             */\n            FilterOperator[\"StartsWith\"] = \"startswith\";\n        })(FilterOperator || (FilterOperator = {}));\n\n        function forEachDesc(desc, callbackfn) {\n            if ('filters' in desc) {\n                desc.filters.map(function (child) { return forEachDesc(child, callbackfn); });\n            }\n            else {\n                callbackfn(desc);\n            }\n        }\n        var filterFields = function (filter, callback) {\n            var descriptors = Array.isArray(filter) ? filter : filter.filters;\n            descriptors.forEach(function (desc) { return forEachDesc(desc, callback); });\n        };\n        /** @hidden */\n        var initializeFiltering = function (rows, columns, filter) {\n            var compositeFilter = filter ?\n                (Array.isArray(filter) ? { logic: 'and', filters: filter } : filter) : undefined;\n            var predicate = compositeFilter ? compileFilter(compositeFilter) : function () { return true; };\n            var axes = rows.concat(columns);\n            var fieldValues = [];\n            filterFields(filter || [], function (desc) {\n                if ('field' in desc && desc.field) {\n                    fieldValues.push(desc.field);\n                }\n            });\n            var result = { hasFilter: false, predicate: predicate, filteringAxes: [] };\n            if (fieldValues.some(function (f) { return typeof f === 'function'; })) {\n                result.filteringAxes = axes.slice();\n            }\n            else if (fieldValues.length > 0) {\n                var filteringFields_1 = Array.from(new Set(fieldValues).values());\n                var filteringAxes = axes.filter(function (a) { return filteringFields_1.indexOf(a.key) >= 0; });\n                result.filteringAxes = filteringAxes;\n            }\n            result.hasFilter = result.filteringAxes.length > 0;\n            return result;\n        };\n\n        /** @hidden */\n        var subNode = function (node, field, initialNode) {\n            var childNode = node.get(field);\n            if (!childNode) {\n                childNode = initialNode || new Map();\n                node.set(field, childNode);\n            }\n            return childNode;\n        };\n        var separator = '&';\n        /** @hidden */\n        var createKey = function (key, value) { return key + separator + value; };\n        /** @hidden */\n        var splitKeyValue = function (keyValue) {\n            var separatorIndex = keyValue.indexOf(separator);\n            if (separatorIndex !== -1) {\n                var key = keyValue.substring(0, separatorIndex);\n                var value = keyValue.substring(separatorIndex + 1);\n                return [key, value];\n            }\n            else {\n                return [keyValue, undefined];\n            }\n        };\n\n        var calculateColumnData = function (node, measures, dataField) {\n            node.forEach(function (childNode, k) {\n                if (k !== dataField) {\n                    if (childNode.size > 0) {\n                        calculateColumnData(childNode, measures, dataField);\n                    }\n                    var childData_1 = childNode.get(dataField);\n                    var parentData_1 = subNode(node, dataField, {});\n                    measures.forEach(function (m) {\n                        m.aggregate.init(parentData_1);\n                        m.aggregate.merge(childData_1, parentData_1);\n                    });\n                }\n            });\n        };\n        /** @hidden */\n        var mergeTrees = function (src, dest, measures, dataField) {\n            src.forEach(function (srcChild, k) {\n                var destChild;\n                if (k !== dataField) {\n                    destChild = subNode(dest, k);\n                    mergeTrees(srcChild, destChild, measures, dataField);\n                }\n                else {\n                    destChild = subNode(dest, k, {});\n                    measures.forEach(function (m) {\n                        m.aggregate.init(destChild);\n                        m.aggregate.merge(srcChild, destChild);\n                    });\n                }\n            });\n        };\n        var calculateColumns = function (node, measures, columnsData, dataField) {\n            node.forEach(function (childNode, k) {\n                if (k !== columnsData) {\n                    if (childNode.size > 0) {\n                        calculateColumns(childNode, measures, columnsData, dataField);\n                    }\n                    var srcColumns = subNode(childNode, columnsData);\n                    var destColumns = subNode(node, columnsData);\n                    mergeTrees(srcColumns, destColumns, measures, dataField);\n                }\n            });\n        };\n        /** @hidden */\n        var createDataTree = function (data, rows, columns, measures, fields, filter) {\n            var result = new Map();\n            var cache = new Map();\n            var axes = rows.concat(columns);\n            var leafNodes = new Set();\n            var dataField = fields.dataField, columnsData = fields.columnsData;\n            var _a = initializeFiltering(rows, columns, filter), hasFilter = _a.hasFilter, predicate = _a.predicate, filteringAxes = _a.filteringAxes;\n            var empty = '';\n            data.forEach(function (dataItem) {\n                if (hasFilter) {\n                    var filteringDataItem_1 = {};\n                    filteringAxes.forEach(function (axis) { filteringDataItem_1[axis.key] = axis.displayValue(dataItem); });\n                    if (!predicate(filteringDataItem_1)) {\n                        return;\n                    }\n                }\n                var values = axes.map(function (a) { return a.displayValue(dataItem); });\n                var dataKey = empty.concat.apply(empty, values);\n                var nodeData = cache.get(dataKey);\n                if (!nodeData) {\n                    var node_1 = result;\n                    var eachAxis = function (axis) {\n                        node_1 = subNode(node_1, createKey(axis.key, axis.displayValue(dataItem)));\n                    };\n                    rows.forEach(eachAxis);\n                    node_1 = subNode(node_1, columnsData);\n                    leafNodes.add(node_1);\n                    columns.forEach(eachAxis);\n                    nodeData = {};\n                    node_1.set(dataField, nodeData);\n                    cache.set(dataKey, nodeData);\n                    measures.forEach(function (m) {\n                        m.aggregate.init(nodeData);\n                    });\n                }\n                measures.forEach(function (m) {\n                    m.aggregate.accumulate(nodeData, m.value(dataItem));\n                });\n            });\n            leafNodes.forEach(function (leaf) { return calculateColumnData(leaf, measures, dataField); });\n            calculateColumns(result, measures, columnsData, dataField);\n            return result;\n        };\n        /** @hidden */\n        var cloneDataTree = function (dataTree, dataField, measures) {\n            var result = new Map();\n            mergeTrees(dataTree, result, measures, dataField);\n            return result;\n        };\n\n        var createPath = function (name, axes, path) {\n            var _a = splitKeyValue(name), key = _a[0], value = _a[1];\n            var result = path.slice();\n            if (key && value) {\n                var axis = axes.find(function (a) { return a.key === key; });\n                var caption_1 = axis ? axis.caption : '';\n                return result.map(function (p) { return p === caption_1 ? name : p; });\n            }\n            return result;\n        };\n        var membersNode = function (tree, members, field, axisSettings, measures, dataField, cache) {\n            var cacheData = cache || new Map();\n            var path = axisSettings.map(function (a) { return a.caption; });\n            while (members.length > 1 && axisSettings.some(function (a) { return a.caption === members[members.length - 1].caption; })) {\n                members.pop();\n                path.pop();\n            }\n            var node = tree;\n            members.forEach(function (m, i) {\n                path = createPath(m.name, axisSettings, path);\n                if (node && !axisSettings.some(function (a) { return a.caption === m.name; })) {\n                    if (!node.has(m.name) && !cacheData.has(path.slice(0, path.indexOf(m.name) + 1).join('-'))) {\n                        var currentLevel = Array.from(node).find(function (n) { return n[0] !== field; });\n                        var currentLevelNode = currentLevel && currentLevel[0];\n                        var levelField_1 = currentLevelNode && splitKeyValue(currentLevelNode)[0];\n                        var depth = levelField_1 ? i - axisSettings.findIndex(function (a) { return a.key === levelField_1; }) : 0;\n                        var _loop_1 = function (t) {\n                            var data = [];\n                            node.forEach(function (value, key) {\n                                if (key !== field) {\n                                    data.push.apply(data, Array.from(value).filter(function (d) { return d[0] !== field; }));\n                                }\n                            });\n                            var next = new Map();\n                            data.forEach(function (item) {\n                                if (next.has(item[0])) {\n                                    var dest = next.get(item[0]);\n                                    var src = item[1];\n                                    var newDest = new Map();\n                                    mergeTrees(dest, newDest, measures, dataField);\n                                    mergeTrees(src, newDest, measures, dataField);\n                                    next.set(item[0], newDest);\n                                }\n                                else {\n                                    next.set(item[0], new Map(item[1]));\n                                }\n                            });\n                            var currentPath = path.slice(0, path.indexOf(m.name));\n                            next.forEach(function (value, key) {\n                                cacheData.set(createPath(key, axisSettings, currentPath.concat([key])).join('-'), value);\n                            });\n                            next.set(field, node.get(field));\n                            node = next;\n                        };\n                        for (var t = 0; t < depth; t++) {\n                            _loop_1(t);\n                        }\n                    }\n                    node = node.get(m.name) || cacheData.get(path.slice(0, path.indexOf(m.name) + 1).join('-'));\n                }\n            });\n            return node;\n        };\n        /** @hidden */\n        var readData = function (dataTree, rowTuples, columnTuples, fields, columnSettings, rowSettings, measures) {\n            var data = [];\n            var dataField = fields.dataField, columnsData = fields.columnsData;\n            var rowsCache = new Map();\n            rowTuples.forEach(function (row) {\n                var rowNode = membersNode(dataTree, row.members.slice(), columnsData, rowSettings, measures, dataField, rowsCache);\n                var rowColumnsNode = rowNode && rowNode.get(columnsData);\n                columnTuples.forEach(function (col) {\n                    var members = col.members.slice();\n                    var measure = measures[0];\n                    if (members[members.length - 1].levelName === \"[Measures].[MeasuresLevel]\") {\n                        var measuresMember_1 = members.pop();\n                        measure = measures.find(function (m) { return String(m.name) === measuresMember_1.caption; }) || measure;\n                    }\n                    var colNode = rowColumnsNode && membersNode(rowColumnsNode, members, dataField, columnSettings, measures, dataField);\n                    var value = '', fmtValue = '', ordinal = 0;\n                    if (colNode && measure) {\n                        var result = measure.aggregate.result(colNode.get(dataField));\n                        value = String(result);\n                        fmtValue = measure.aggregate.format(result);\n                    }\n                    data.push({\n                        columnTuple: col,\n                        data: { fmtValue: fmtValue, ordinal: ordinal, value: value },\n                        rowTuple: row\n                    });\n                });\n            });\n            return data;\n        };\n\n        var getTopMembersTuple = function (parentFields, axesSettings) {\n            var allTuple = { members: [] };\n            parentFields.forEach(function (topField) {\n                var axis = axesSettings.find(function (a) { return a.key === topField; });\n                var caption = axis ? axis.caption : \"\";\n                var member = {\n                    caption: caption,\n                    children: [],\n                    hasChildren: true,\n                    parentName: \"\",\n                    levelNum: 0,\n                    levelName: caption,\n                    hierarchy: topField,\n                    name: caption\n                };\n                allTuple.members.push(member);\n            });\n            return allTuple;\n        };\n        var sortFunc = function (descriptor, axe) {\n            return function (a, b) {\n                var order = descriptor.dir;\n                var sortableA = axe.sortValue(splitKeyValue(a[0])[1]);\n                var sortableB = axe.sortValue(splitKeyValue(b[0])[1]);\n                if (sortableA < sortableB) {\n                    return order === \"asc\" ? -1 : 1;\n                }\n                if (sortableA > sortableB) {\n                    return order === \"asc\" ? 1 : -1;\n                }\n                return 0;\n            };\n        };\n        var mergeData = function (src, dest, exclude) {\n            src.forEach(function (srcChild, k) {\n                if (!exclude[k]) {\n                    var destChild = subNode(dest, k);\n                    mergeData(srcChild, destChild, exclude);\n                }\n            });\n        };\n        var childrenByKeys = function (dataTree, keys, exclude) {\n            var result = [];\n            var nodeData = function (node) { return Array.from(node).filter(function (n) { return !exclude[n[0]]; }); };\n            var element = new Map(dataTree);\n            var next;\n            var _loop_1 = function (i) {\n                next = element.get(keys[i]);\n                if (next) {\n                    element = new Map(next);\n                }\n                else if (i < keys.length - 1 && Array.from(element).some(function (e) { return splitKeyValue(e[0])[0] === keys[i]; })) {\n                    var curLevel_1 = [];\n                    element.forEach(function (child, key) {\n                        if (!exclude[key]) {\n                            curLevel_1.push.apply(curLevel_1, nodeData(new Map(child)));\n                        }\n                    });\n                    element = new Map();\n                    curLevel_1.forEach(function (item) {\n                        if (element.has(item[0])) {\n                            var dest = element.get(item[0]);\n                            var src = item[1];\n                            var newDest = new Map();\n                            mergeData(dest, newDest, exclude);\n                            mergeData(src, newDest, exclude);\n                            element.set(item[0], newDest);\n                        }\n                        else {\n                            element.set(item[0], new Map(item[1]));\n                        }\n                    });\n                }\n                else if (i === 0 || i === keys.length - 1) {\n                    if (Array.from(element).some(function (e) { return splitKeyValue(e[0])[0] === keys[i]; })) {\n                        result.push.apply(result, nodeData(element));\n                    }\n                }\n            };\n            for (var i = 0; i < keys.length; i++) {\n                _loop_1(i);\n            }\n            return result;\n        };\n        /** @hidden */\n        var rootFields = function (definitions) {\n            var fields = new Set();\n            definitions.forEach(function (item) {\n                if (item.name.length === 1 && !splitKeyValue(item.name[0])[1]) {\n                    fields.add(item.name[0]);\n                }\n            });\n            return fields;\n        };\n        /** @hidden */\n        var createTuples = function (axesSettings, definitions, dataTree, sortDescriptors, excludeFields) {\n            var parentFields = rootFields(definitions);\n            var flatMembers = [];\n            var topTuple = getTopMembersTuple(parentFields, axesSettings);\n            flatMembers.push(topTuple);\n            var _loop_2 = function (i) {\n                var currDef = definitions[i];\n                if (currDef.name.length === 1 && !currDef.expand && parentFields.has(currDef.name[0])) {\n                    return \"continue\";\n                }\n                var keysToAdd = new Set(parentFields.keys());\n                var currDefMembers = [];\n                var keys = [];\n                var tuples = [];\n                var axe;\n                currDef.name.forEach(function (element, index) {\n                    var _a;\n                    var _b = splitKeyValue(element), field = _b[0], value = _b[1];\n                    axe = axesSettings.find(function (a) { return a.key === field; });\n                    if (value) {\n                        keysToAdd.delete(field);\n                        keys.push(element);\n                        var member = {\n                            children: [],\n                            caption: value,\n                            hierarchy: field,\n                            levelNum: 1,\n                            levelName: field + \" \" + field,\n                            name: element,\n                            parentName: axe ? axe.caption : \"\"\n                        };\n                        currDefMembers.push(member);\n                    }\n                    else if (currDef.expand && currDef.name.length - 1 === index) {\n                        keysToAdd.delete(element);\n                        keys.push(element);\n                        var children = childrenByKeys(dataTree, keys, excludeFields);\n                        var descriptor = sortDescriptors.find(function (desc) { return desc.field === field; });\n                        if (descriptor && descriptor.dir) {\n                            children.sort(sortFunc(descriptor, axe));\n                        }\n                        for (var c = 0; c < children.length; c++) {\n                            var leafValue = children[c][0];\n                            var leafTuple = { members: [] };\n                            tuples.push(leafTuple);\n                            var caption = splitKeyValue(leafValue)[1];\n                            axe = axesSettings.find(function (a) { return a.key === element; });\n                            var member = {\n                                caption: caption,\n                                children: [],\n                                levelName: element + \" \" + element,\n                                levelNum: 1,\n                                parentName: axe ? axe.caption : \"\",\n                                hierarchy: element,\n                                name: leafValue\n                            };\n                            (_a = leafTuple.members).push.apply(_a, currDefMembers);\n                            leafTuple.members.push(member);\n                        }\n                    }\n                    else if (currDef.expand) {\n                        axe = axesSettings.find(function (a) { return a.key === element; });\n                        var axisCaption = axe ? axe.caption : \"\";\n                        keysToAdd.delete(element);\n                        keys.push(element);\n                        var member = {\n                            children: [],\n                            caption: axisCaption,\n                            hierarchy: element,\n                            levelName: axisCaption,\n                            levelNum: 0,\n                            name: axisCaption,\n                            parentName: \"\"\n                        };\n                        currDefMembers.push(member);\n                    }\n                    keysToAdd.forEach(function (key) {\n                        tuples.forEach(function (tuple) {\n                            axe = axesSettings.find(function (a) { return a.key === key; });\n                            var curCaption = axe ? axe.caption : \"\";\n                            var member = {\n                                children: [],\n                                hasChildren: true,\n                                caption: curCaption,\n                                hierarchy: key,\n                                levelName: curCaption,\n                                levelNum: 0,\n                                name: curCaption,\n                                parentName: \"\"\n                            };\n                            tuple.members.push(member);\n                        });\n                    });\n                    flatMembers.push.apply(flatMembers, tuples);\n                });\n            };\n            for (var i = 0; i < definitions.length; i++) {\n                _loop_2(i);\n            }\n            return flatMembers;\n        };\n        var measureToMember = function (measure) {\n            return {\n                caption: String(measure.name),\n                children: [],\n                hasChildren: false,\n                hierarchy: \"[Measures]\",\n                levelName: \"[Measures].[MeasuresLevel]\",\n                levelNum: 0,\n                name: \"[Measures].[\" + measure.name + \"]\",\n                parentName: \"\"\n            };\n        };\n        var addMeasure = function (tuple, measure) {\n            var measureMember = measureToMember(measure);\n            var tupleCopy = copy(tuple);\n            tupleCopy.members.push(measureMember);\n            return tupleCopy;\n        };\n        /** @hidden */\n        var addMultipleMeasures = function (tuples, measures) {\n            if (measures.length < 2) {\n                return tuples;\n            }\n            var result = tuples.slice();\n            for (var i = result.length - 1; i >= 0; i--) {\n                var tuple = result[i];\n                result[i] = addMeasure(result[i], measures[0]);\n                for (var m = 1; m < measures.length; m++) {\n                    var tupleWithMeasure = addMeasure(tuple, measures[m]);\n                    result.splice(i + m, 0, tupleWithMeasure);\n                }\n            }\n            return reverseColumnsByMeasures(result);\n        };\n        /** @hidden */\n        var createLocalDataState = function (args) {\n            var _a;\n            var dataTree = args.dataTree, rowSettings = args.rowSettings, columnSettings = args.columnSettings, rowAxes = args.rowAxes, columnAxes = args.columnAxes, measures = args.measures, sort = args.sort, fields = args.fields;\n            var exclude = (_a = {}, _a[fields.columnsData] = fields.columnsData, _a[fields.dataField] = fields.dataField, _a);\n            var colTuples = columnAxes.length ?\n                createTuples(columnSettings, columnAxes, dataTree.get(fields.columnsData), sort, exclude) :\n                measures.map(function (m) { return ({ members: [measureToMember(m)] }); });\n            var columnTuples = columnAxes.length > 0 ? addMultipleMeasures(colTuples, measures) : colTuples;\n            var rowTuples = rowAxes.length ? createTuples(rowSettings, rowAxes, dataTree, sort, exclude) : [{ members: [] }];\n            var resultData = readData(dataTree, rowTuples, columnTuples, fields, columnSettings, rowSettings, measures);\n            return {\n                columns: columnTuples,\n                data: resultData,\n                rows: rowTuples\n            };\n        };\n\n        /** @hidden */\n        var createFlatSchemaDimensions = function (dimensions, measures) {\n            var result = Object.keys(dimensions).map(function (dim) { return ({\n                caption: dim,\n                defaultHierarchy: dim,\n                description: '',\n                name: dim,\n                uniqueName: dim,\n                hierarchyUniqueName: dim,\n                measure: true,\n                type: 1 // https://github.com/telerik/kendo-pivotgrid-common/blob/develop/src/models/responseDiscover.ts#L12-L14\n            }); });\n            if (measures.length) {\n                result.push({\n                    caption: 'Measures',\n                    children: measures.map(function (m) { return ({\n                        aggregator: '1',\n                        caption: String(m.name),\n                        defaultFormat: '',\n                        description: '',\n                        displayFolder: '',\n                        groupName: String(m.name),\n                        name: String(m.name),\n                        uniqueName: String(m.name)\n                    }); }),\n                    type: 2,\n                    description: '',\n                    name: 'Measures',\n                    uniqueName: '[Measures]'\n                });\n            }\n            return result;\n        };\n\n        var Navigation = /** @class */ (function () {\n            function Navigation(options) {\n                this.tabIndex = 0;\n                this.root = null;\n                this.eventHandlers = {};\n                this.update = function () { };\n                this.tabIndex = options.tabIndex;\n            }\n            Object.defineProperty(Navigation.prototype, \"elements\", {\n                get: function () {\n                    return this.root ? Array.from(this.root.querySelectorAll(this.selectors.join(','))) : [];\n                },\n                enumerable: false,\n                configurable: true\n            });\n            Object.defineProperty(Navigation.prototype, \"first\", {\n                get: function () {\n                    return (this.root && this.root.querySelector(this.selectors.join(','))) || null;\n                },\n                enumerable: false,\n                configurable: true\n            });\n            Object.defineProperty(Navigation.prototype, \"last\", {\n                get: function () {\n                    var all = this.elements;\n                    return all[all.length - 1] || null;\n                },\n                enumerable: false,\n                configurable: true\n            });\n            Object.defineProperty(Navigation.prototype, \"current\", {\n                get: function () {\n                    return this.elements.find(function (el) { return el.matches(':focus'); });\n                },\n                enumerable: false,\n                configurable: true\n            });\n            Navigation.prototype.start = function (root) {\n                var _this = this;\n                this.root = root;\n                var _loop_1 = function (eventType) {\n                    if (this_1.mouseEvents[eventType]) {\n                        this_1.eventHandlers[eventType] = (function (ev) {\n                            var target = ev.target instanceof Element && ev.target.closest(_this.selectors.join(','));\n                            if (target) {\n                                _this.mouseEvents[eventType].call(undefined, target, _this, ev);\n                            }\n                        });\n                        root.addEventListener(eventType, this_1.eventHandlers[eventType]);\n                    }\n                };\n                var this_1 = this;\n                for (var eventType in this.mouseEvents) {\n                    _loop_1(eventType);\n                }\n                var _loop_2 = function (eventType) {\n                    if (this_2.keyboardEvents[eventType]) {\n                        this_2.eventHandlers[eventType] = (function (ev) {\n                            var target = ev.target instanceof Element && ev.target.closest(_this.selectors.join(','));\n                            var key = ev.key === ' ' ? 'Space' : ev.key;\n                            if (target && _this.keyboardEvents[eventType][key]) {\n                                _this.keyboardEvents[eventType][key].call(undefined, target, _this, ev);\n                            }\n                        });\n                        root.addEventListener(eventType, this_2.eventHandlers[eventType]);\n                    }\n                };\n                var this_2 = this;\n                for (var eventType in this.keyboardEvents) {\n                    _loop_2(eventType);\n                }\n            };\n            Navigation.prototype.stop = function () {\n                if (this.root) {\n                    for (var eventType in this.eventHandlers) {\n                        if (this.eventHandlers[eventType]) {\n                            this.root.removeEventListener(eventType, this.eventHandlers[eventType]);\n                        }\n                    }\n                }\n                this.root = null;\n            };\n            Navigation.prototype.focusElement = function (element, previous) {\n                if (element) {\n                    if (previous) {\n                        previous.removeAttribute('tabindex');\n                        previous.classList.remove('k-focus');\n                    }\n                    element.setAttribute('tabindex', String(this.tabIndex));\n                    element.focus({ preventScroll: true });\n                }\n            };\n            return Navigation;\n        }());\n\n        var scrollableValuesSel = '.k-pivotgrid .k-pivotgrid-values';\n        var scrollableColumnHeaderSel = '.k-pivotgrid .k-pivotgrid-column-headers';\n        var scrollableRowHeaderSel = '.k-pivotgrid .k-pivotgrid-row-headers';\n        var emptyCellSel = '.k-pivotgrid > .k-pivotgrid-empty-cell';\n        var tableSel = 'table.k-pivotgrid-table';\n        var cellSel = '.k-pivotgrid-cell';\n        var scrollables = [scrollableValuesSel, scrollableColumnHeaderSel, scrollableRowHeaderSel].join(',');\n        var selectors$1 = [\n            emptyCellSel,\n            [scrollableColumnHeaderSel, tableSel, cellSel].join(' '),\n            [scrollableRowHeaderSel, tableSel, cellSel].join(' '),\n            [scrollableValuesSel, tableSel, cellSel].join(' ')\n        ];\n        var onEnter = function (target, nav, ev) {\n            var icon = target.querySelector('.k-icon, .k-svg-icon');\n            if (icon) {\n                var index_1 = nav.elements.indexOf(target);\n                nav.update = function () {\n                    nav.focusElement(nav.elements[index_1], null);\n                    nav.update = function () { };\n                };\n                icon.click();\n                ev.preventDefault();\n            }\n        };\n        var tryScrollLeft = function (target, scrollable, elToScroll) {\n            if (target.offsetLeft < scrollable.scrollLeft) {\n                elToScroll.scrollLeft = target.offsetLeft;\n            }\n        };\n        var tryScrollRight = function (target, scrollable, elToScroll) {\n            if (target.offsetLeft + target.offsetWidth > scrollable.scrollLeft + scrollable.offsetWidth &&\n                target.offsetWidth < scrollable.offsetWidth) {\n                elToScroll.scrollLeft = target.offsetLeft + target.offsetWidth - scrollable.offsetWidth;\n            }\n        };\n        var tryScrollUp = function (target, scrollable, elToScroll) {\n            if (scrollable.scrollTop && target.offsetTop < scrollable.scrollTop) {\n                elToScroll.scrollTop = target.offsetTop;\n            }\n        };\n        var tryScrollDown = function (target, scrollable, elToScroll) {\n            if (target.offsetTop + target.offsetHeight > scrollable.scrollTop + scrollable.offsetHeight &&\n                target.offsetHeight < scrollable.offsetHeight) {\n                elToScroll.scrollTop = target.offsetTop + target.offsetHeight - scrollable.offsetHeight;\n            }\n        };\n        var scrollTo = function (target, root, scrollFunc) {\n            var elToScroll = root.querySelector(scrollableValuesSel);\n            var scrollable = target && target.closest(scrollables);\n            if (!elToScroll || !scrollable || !target) {\n                return;\n            }\n            scrollFunc.forEach(function (scroll) { return scroll(target, scrollable, elToScroll); });\n        };\n        var tableMap = function (table) {\n            var rows = Array.from(table.rows);\n            var colsCount = Array.from((rows && rows[0] && rows[0].cells) || [])\n                .map(function (c) { return c.colSpan; })\n                .reduce(function (prev, cur) { return prev + cur; }, 0);\n            var map = rows.map(function () { return new Array(colsCount); });\n            rows.forEach(function (row, r) {\n                var curColSpan = 0;\n                Array.from(row.cells).forEach(function (c) {\n                    for (var colSp = 0; colSp < c.colSpan; colSp++) {\n                        for (var rowSp = 0; rowSp < c.rowSpan; rowSp++) {\n                            var ind = map[r + rowSp].findIndex(function (val, curInd) { return curInd >= curColSpan && !val; });\n                            map[r + rowSp][ind] = c;\n                        }\n                        curColSpan++;\n                    }\n                });\n            });\n            return map;\n        };\n        var navigationMap = function (root) {\n            var columnHeader = tableMap(root.querySelector([scrollableColumnHeaderSel, tableSel].join(' ')));\n            var rowHeader = tableMap(root.querySelector([scrollableRowHeaderSel, tableSel].join(' ')));\n            var values = tableMap(root.querySelector([scrollableValuesSel, tableSel].join(' ')));\n            var emptyCell = root.querySelector(emptyCellSel);\n            var emptyCellRow = new Array(rowHeader[0].length).fill(emptyCell);\n            var map = [];\n            for (var i = 0; i < columnHeader.length; i++) {\n                map.push(emptyCellRow.concat(columnHeader[i]));\n            }\n            for (var i = 0; i < rowHeader.length; i++) {\n                map.push(rowHeader[i].concat(values[i]));\n            }\n            return map;\n        };\n        var getTargetPos = function (map, target) {\n            for (var r = 0; r < map.length; r++) {\n                for (var c = 0; c < map[r].length; c++) {\n                    if (map[r][c] === target) {\n                        return [r, c];\n                    }\n                }\n            }\n            return [-1, -1];\n        };\n        var ctrlKey = function (ev) { return ev.ctrlKey || ev.metaKey; };\n        var cellAt = function (root, target, pos) {\n            var map = navigationMap(root);\n            var targetPos = getTargetPos(map, target);\n            var nextPos = [targetPos[0] + pos[0], targetPos[1] + pos[1]];\n            var next = map[nextPos[0]] && map[nextPos[0]][nextPos[1]];\n            while (next && next === target) {\n                nextPos = [nextPos[0] + pos[0], nextPos[1] + pos[1]];\n                next = map[nextPos[0]] && map[nextPos[0]][nextPos[1]];\n            }\n            return next;\n        };\n        var keyboardEvents$1 = {\n            keydown: {\n                ArrowLeft: function (target, nav, ev) {\n                    ev.preventDefault();\n                    var next = cellAt(nav.root, target, [0, -1]);\n                    nav.focusElement(next, target);\n                    scrollTo(next, nav.root, [tryScrollRight, tryScrollLeft, tryScrollDown, tryScrollUp]);\n                },\n                ArrowRight: function (target, nav, ev) {\n                    ev.preventDefault();\n                    var next = cellAt(nav.root, target, [0, 1]);\n                    nav.focusElement(next, target);\n                    scrollTo(next, nav.root, [tryScrollLeft, tryScrollRight, tryScrollDown, tryScrollUp]);\n                },\n                ArrowUp: function (target, nav, ev) {\n                    ev.preventDefault();\n                    var next = cellAt(nav.root, target, [-1, 0]);\n                    nav.focusElement(next, target);\n                    scrollTo(next, nav.root, [tryScrollRight, tryScrollLeft, tryScrollDown, tryScrollUp]);\n                },\n                ArrowDown: function (target, nav, ev) {\n                    ev.preventDefault();\n                    var next = cellAt(nav.root, target, [1, 0]);\n                    nav.focusElement(next, target);\n                    scrollTo(next, nav.root, [tryScrollRight, tryScrollLeft, tryScrollUp, tryScrollDown]);\n                },\n                o: function (_target, nav, _ev) {\n                    if (!nav.root) {\n                        return;\n                    }\n                    var next = nav.root.nextElementSibling;\n                    if (next && next instanceof HTMLElement && next.matches('div.k-pivotgrid-configurator-button')) {\n                        next.click();\n                        setTimeout(function () {\n                            if (nav.root.parentNode) {\n                                var confHeader = nav.root.parentNode.querySelector('.k-pivotgrid-configurator-content .k-form-field .k-fields-list-wrapper .k-treeview');\n                                if (confHeader instanceof HTMLElement) {\n                                    confHeader.setAttribute('tabindex', String(nav.tabIndex));\n                                    confHeader.focus();\n                                }\n                            }\n                        }, 0);\n                    }\n                },\n                Enter: onEnter,\n                Space: onEnter,\n                Home: function (target, nav, ev) {\n                    var map = navigationMap(nav.root);\n                    var ctrl = ctrlKey(ev);\n                    var row = ctrl ? map[0] : (map.find(function (ro) { return Boolean(ro.find(function (x) { return x === target; })); }) || []);\n                    var next = row[0];\n                    if (next) {\n                        nav.focusElement(next, target);\n                        scrollTo(next, nav.root, [tryScrollRight, tryScrollLeft, tryScrollDown, tryScrollUp]);\n                        ev.preventDefault();\n                    }\n                },\n                End: function (target, nav, ev) {\n                    var map = navigationMap(nav.root);\n                    var ctrl = ctrlKey(ev);\n                    var row = ctrl ? map[map.length - 1] : (map.find(function (ro) { return Boolean(ro.find(function (x) { return x === target; })); }) || []);\n                    var next = row && row[row.length - 1] || null;\n                    if (next) {\n                        nav.focusElement(next, target);\n                        scrollTo(next, nav.root, [tryScrollLeft, tryScrollRight, tryScrollUp, tryScrollDown]);\n                        ev.preventDefault();\n                    }\n                }\n            }\n        };\n        var mouseEvents$1 = {\n            click: function (target, nav) {\n                if (target && target instanceof HTMLElement) {\n                    var prev = nav.elements.find(function (c) { return c.hasAttribute('tabindex'); }) || null;\n                    nav.focusElement(target, prev);\n                }\n            }\n        };\n        /**\n         * The PivotGrid keyboard navigation functionality.\n         *\n         * Usage:\n         *\n         * On Initialize\n         * const navigation = new PivotGridNavigation({ tabindex: 0 });\n         *\n         * Turn on\n         * navigation.start(rootDomElement);\n         *\n         * On After Update\n         * navigation.update();\n         *\n         * On Destroy / Turn off\n         * navigation.stop();\n         */\n        var PivotGridNavigation = /** @class */ (function (_super) {\n            __extends(PivotGridNavigation, _super);\n            function PivotGridNavigation() {\n                var _this = _super !== null && _super.apply(this, arguments) || this;\n                _this.selectors = selectors$1;\n                _this.mouseEvents = mouseEvents$1;\n                _this.keyboardEvents = keyboardEvents$1;\n                return _this;\n            }\n            return PivotGridNavigation;\n        }(Navigation));\n\n        var selectors = [\n            '.k-pivotgrid-configurator-content .k-form-field .k-fields-list-wrapper .k-treeview',\n            '.k-pivotgrid-configurator-content .k-chip',\n            '.k-pivotgrid-configurator-actions button'\n        ];\n        var onEscape = function (_target, nav, ev) {\n            if (ev.target instanceof HTMLElement) {\n                if (nav.root) {\n                    var pivot = nav.root.previousElementSibling;\n                    var confButton = nav.root.nextElementSibling;\n                    var pivotCell = Array.from(pivot instanceof HTMLElement ? pivot.querySelectorAll('[tabindex]') : []).find(function (c) { return c.tabIndex >= 0; });\n                    if (pivotCell instanceof HTMLElement) {\n                        pivotCell.focus();\n                        if (confButton instanceof HTMLElement) {\n                            confButton.click();\n                        }\n                    }\n                }\n            }\n        };\n        var navigate = function (target, nav, ev, dir) {\n            ev.preventDefault();\n            var all = nav.elements;\n            var index = all.indexOf(target) + dir;\n            if (index < 0) {\n                index = all.length - 1;\n            }\n            nav.focusElement(all[index % all.length], target);\n        };\n        var onDelete = function (target, nav, ev) {\n            if (ev.target instanceof HTMLElement) {\n                var deleteButton = ev.target.querySelector('.k-icon.k-i-x-circle, .k-svg-icon.k-svg-i-x-circle');\n                if (deleteButton instanceof HTMLElement) {\n                    ev.preventDefault();\n                    navigate(target, nav, ev, -1);\n                }\n            }\n        };\n        var keyboardEvents = {\n            keydown: {\n                Tab: function (target, nav, ev) {\n                    navigate(target, nav, ev, ev.shiftKey ? -1 : 1);\n                },\n                Escape: onEscape,\n                Delete: onDelete,\n                Backspace: onDelete\n            }\n        };\n        var mouseEvents = {\n            click: function (target, nav) {\n                if (target && target instanceof HTMLElement) {\n                    var prev = nav.elements.find(function (c) { return c.hasAttribute('tabindex'); }) || null;\n                    nav.focusElement(target, prev);\n                }\n            }\n        };\n        /**\n         * The PivotGrid Configurator keyboard navigation functionality.\n         *\n         * Usage:\n         *\n         * On Initialize\n         * const navigation = new ConfiguratorNavigation({ tabindex: 0 });\n         *\n         * Turn on\n         * navigation.start(rootDomElement);\n         *\n         * On After Update\n         * navigation.update();\n         *\n         * On Destroy / Turn off\n         * navigation.stop();\n         */\n        var ConfiguratorNavigation = /** @class */ (function (_super) {\n            __extends(ConfiguratorNavigation, _super);\n            function ConfiguratorNavigation() {\n                var _this = _super !== null && _super.apply(this, arguments) || this;\n                _this.selectors = selectors;\n                _this.mouseEvents = mouseEvents;\n                _this.keyboardEvents = keyboardEvents;\n                return _this;\n            }\n            return ConfiguratorNavigation;\n        }(Navigation));\n\n        exports.ConfiguratorNavigation = ConfiguratorNavigation;\n        exports.PivotGridNavigation = PivotGridNavigation;\n        exports.addKPI = addKPI;\n        exports.addMultipleMeasures = addMultipleMeasures;\n        exports.averageAggregate = averageAggregate;\n        exports.buildKPIMeasures = buildKPIMeasures;\n        exports.cloneDataTree = cloneDataTree;\n        exports.compareAxes = compareAxes;\n        exports.configuratorReducer = configuratorReducer;\n        exports.countAggregate = countAggregate;\n        exports.createAxisDescriptors = createAxisDescriptors;\n        exports.createDataState = createDataState;\n        exports.createDataTree = createDataTree;\n        exports.createDiscoverBody = createDiscoverBody;\n        exports.createFlatSchemaDimensions = createFlatSchemaDimensions;\n        exports.createLocalDataState = createLocalDataState;\n        exports.createRequestBody = createRequestBody;\n        exports.createTuples = createTuples;\n        exports.discoverCommands = discoverCommands;\n        exports.fetchData = fetchData;\n        exports.fetchDiscover = fetchDiscover;\n        exports.headersReducer = headersReducer;\n        exports.maxAggregate = maxAggregate;\n        exports.mergeTrees = mergeTrees;\n        exports.minAggregate = minAggregate;\n        exports.parseResponse = parseResponse;\n        exports.readData = readData;\n        exports.rootFields = rootFields;\n        exports.setFilter = setFilter;\n        exports.setSort = setSort;\n        exports.sumAggregate = sumAggregate;\n        exports.toColumns = toColumns;\n        exports.toData = toData;\n        exports.toRows = toRows;\n        exports.toTree = toTree;\n\n\n        Object.defineProperty(exports, '__esModule', { value: true });\n\n        return exports;\n\n    })({});\n\n    })();\n\n    var __meta__ = {\n            id: \"pivot.common\",\n            name: \"PivotCommon\",\n            category: \"web\",\n            description: \"Common JS for PivotGrid\",\n            depends: [ \"core\" ]\n        };\n\n}));\n"]}